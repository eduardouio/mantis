{% load static %}
<!DOCTYPE html>
<html lang="es" data-theme="corporate">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{{ title_page }}</title>
      <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.png' %}">
      <!-- jQuery y DataTables con las rutas locales -->
      <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
      <link href="{% static 'css/daisyui.min.css' %}" rel="stylesheet" type="text/css" />
      <script src="{% static 'js/tailwind-browser.js' %}"></script>
      <link href="{% static 'css/daisyui-themes.css' %}" rel="stylesheet" type="text/css" />
      <!-- Line Awesome Icons -->
      <link rel="stylesheet" href="{% static 'css/line-awesome.min.css' %}">
      <!-- Vue.js (versión de desarrollo para mejor debugging) -->
      <script src="{% static 'js/vue-3.global.js' %}"></script>
      <!-- Datatables correctas -->
      <link href="{% static 'css/jquery.dataTables.min.css' %}" rel="stylesheet" />
      <script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
      
      <!-- Extensiones para exportación -->
      <link href="{% static 'css/buttons.dataTables.min.css' %}" rel="stylesheet" />
      <script src="{% static 'js/dataTables.buttons.min.js' %}"></script>
      <script src="{% static 'js/jszip.min.js' %}"></script>
      <script src="{% static 'js/pdfmake.min.js' %}"></script>
      <script src="{% static 'js/vfs_fonts.js' %}"></script>
      <script src="{% static 'js/buttons.html5.min.js' %}"></script>
      <script src="{% static 'js/buttons.print.min.js' %}"></script>
      {% block style%}
      {% endblock %}
      {% block files_header %}
      {% endblock %}
   </head>
   <style>
      table {
    border: 1px solid #d1d5db; /* gray-300 */
    border-collapse: collapse;
  }
  table th, table td {
    padding: 0.25rem; /* padding-1 */
    border: 1px solid #d1d5db; /* gray-300 */
  }
   </style>
   <body class="flex flex-col min-h-screen">

      <div id="app" class="flex flex-col flex-grow">
         {% if title_page != 'Inicio Sesion' %}
         {% if not popup_window %}
         <!-- Nuevo Navbar Responsivo para Items de Menú -->
         <div class="navbar bg-base-100 shadow-lg mb-1 min-h-[3rem] h-14">
            <div class="navbar-start">
               <div class="dropdown">
                  <label tabindex="0" class="btn btn-ghost btn-sm lg:hidden">
                     <i class="las la-bars text-xl"></i>
                  </label>
                  <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1000] p-2 shadow bg-base-100 rounded-box w-52">
                     <!-- Equipos -->
                     <li>
                        <details>
                           <summary>Equipos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'resource_list' %}"><i class="las la-list mr-2"></i>Listar Equipos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'resource_create' %}"><i class="las la-plus mr-2"></i>Crear Equipo</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Vehículos -->
                     <li>
                        <details>
                           <summary>Vehículos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'vehicle_list' %}"><i class="las la-list mr-2"></i>Listar Vehículos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'vehicle_create' %}"><i class="las la-plus mr-2"></i>Crear Vehículo</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Técnicos -->
                     <li>
                        <details>
                           <summary>Técnicos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'technical_list' %}"><i class="las la-list mr-2"></i>Listar Técnicos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'technical_create' %}"><i class="las la-user-plus mr-2"></i>Crear Técnico</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Proyectos -->
                     <li>
                        <details>
                           <summary>Proyectos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'partner_list' %}"><i class="las la-handshake mr-2"></i>Listar Clientes</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'project_list' %}"><i class="las la-list mr-2"></i>Listar Proyectos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'project_create' %}"><i class="las la-plus mr-2"></i>Crear Proyecto</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Planificación -->
                     <li>
                        <details>
                           <summary>Planificación</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-eye mr-2"></i>Ver Planificación</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-plus mr-2"></i>Crear Planificación</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Reportes -->
                     <li>
                        <details>
                           <summary>Reportes</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-tools mr-2"></i>Reporte de Mantenimiento</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-check-circle mr-2"></i>Reporte de Disponibilidad de Equipos</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-wrench mr-2"></i>Reporte de Mantenimiento por Equipos</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-folder-open mr-2"></i>Reporte de Proyectos Activos</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-user-tie mr-2"></i>Reporte de Técnicos</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-certificate mr-2"></i>Licencias</a></li>
                           </ul>
                        </details>
                     </li>
                     <li><div class="divider my-1"></div></li>
                     <!-- Salir para móvil -->
                     <li>
                        <a class="text-error border border-black" href="{% url 'logout' %}">
                           Salir
                        </a>
                     </li>
                  </ul>
               </div>
               <a class="btn btn-ghost btn-sm normal-case text-lg" href="{% url 'home' %}">
                  <img src="/static/img/logo.png" alt="Logo" class="h-7 rounded" />
               </a>
            </div>
            <div class="navbar-center hidden lg:flex">
               <ul class="menu menu-horizontal menu-sm px-1">
                  <!-- Equipos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-desktop inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Equipos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'resource_list' %}"><i class="las la-list mr-2"></i>Listar Equipos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'resource_create' %}"><i class="las la-plus mr-2"></i>Crear Equipo</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Vehículos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-truck inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Vehículos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'vehicle_list' %}"><i class="las la-list mr-2"></i>Listar Vehículos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'vehicle_create' %}"><i class="las la-plus mr-2"></i>Crear Vehículo</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Técnicos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-users inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Técnicos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'technical_list' %}"><i class="las la-list mr-2"></i>Listar Técnicos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'technical_create' %}"><i class="las la-user-plus mr-2"></i>Crear Técnico</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Proyectos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-project-diagram inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Proyectos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'partner_list' %}"><i class="las la-handshake mr-2"></i>Listar Clientes</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'project_list' %}"><i class="las la-list mr-2"></i>Listar Proyectos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'project_create' %}"><i class="las la-plus mr-2"></i>Crear Proyecto</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Planificación -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-calendar inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Planificación</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-eye mr-2"></i>Ver Planificación</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-plus mr-2"></i>Crear Planificación</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Reportes -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-chart-bar inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Reportes</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-tools mr-2"></i>Reporte de Mantenimiento</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-check-circle mr-2"></i>Reporte de Disponibilidad de Equipos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-wrench mr-2"></i>Reporte de Mantenimiento por Equipos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-folder-open mr-2"></i>Reporte de Proyectos Activos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-user-tie mr-2"></i>Reporte de Técnicos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-certificate mr-2"></i>Licencias</a></li>
                        </ul>
                     </details>
                  </li>
               </ul>
            </div>
            <div class="navbar-end hidden lg:flex">
                <ul class="menu menu-horizontal menu-sm px-1">
                    <!-- Dropdown de Usuario -->
                    <li>
                        <details>
                           <summary class="py-2">
                              <div class="flex items-center gap-2">
                                 <div class="avatar placeholder">
                                    <div class="bg-neutral text-neutral-content rounded-full w-8">
                                       <span class="text-xs">{{ user.first_name.0|default:"U" }}{{ user.last_name.0|default:"" }}</span>
                                    </div>
                                 </div>
                                 <span class="text-sm">{{ user.get_full_name|default:user.username }}</span>
                              </div>
                           </summary>
                           <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50 w-52">
                              <li>
                                 <a class="whitespace-nowrap bg-base-100 text-sm" href="#">
                                    <i class="las la-user mr-2"></i>Mi Perfil
                                 </a>
                              </li>
                              <li>
                                 <a class="whitespace-nowrap bg-base-100 text-error text-sm" href="{% url 'logout' %}">
                                    <i class="las la-sign-out-alt mr-2"></i>Salir
                                 </a>
                              </li>
                           </ul>
                        </details>
                     </li>
                </ul>
            </div>
         </div>
         {% endif %}
         {% if show_alert  %}
         <div class="container mx-auto">
            <div class="alert alert-warning" role="alert">
               Esta es una alerta del sistema
            </div>
         </div>
         {% endif %}
         {% if show_toolbar %}
         <div class="container mx-auto bg-base-200 m-1 p-1">
            <div class="flex gap-2">
               <div class="flex-1">Column</div>
               <div class="flex-1">Column</div>
               <div class="flex-1">Column</div>
            </div>
         </div>
         {% endif %}
         {% endif %}
         
         <main class="flex-grow">
            {% if title_page != 'Inicio Sesion' %}
            {% if show_alert  %}
            <div class="container mx-auto">
               <div class="alert alert-warning" role="alert">
                  Esta es una alerta del sistema
               </div>
            </div>
            {% endif %}
            {% if show_toolbar %}
            <div class="container mx-auto bg-base-200 m-1 p-1">
               <div class="flex gap-2">
                  <div class="flex-1">Column</div>
                  <div class="flex-1">Column</div>
                  <div class="flex-1">Column</div>
               </div>
            </div>
            {% endif %}
            {% endif %}
            {% block content %}
            {% endblock %}
         </main>

         {% if title_page != 'Inicio Sesion' %}
         {% if not popup_window %}
         <footer class="bg-zinc-700 text-base-100 mt-10 py-10">
            <div class="container mx-auto px-4">
               <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                  <div>
                     <h5 class="font-bold text-lg mb-3">Navegación</h5>
                     <ul class="space-y-2">
                        <li><a  class="whitespace-nowrap" href="{% url 'resource_list' %}" class="link link-hover">Equipos</a></li>
                        <li><a  class="whitespace-nowrap" href="{% url 'vehicle_list' %}" class="link link-hover">Vehículos</a></li>
                        <li><a  class="whitespace-nowrap" href="{% url 'technical_list' %}" class="link link-hover">Técnicos</a></li>
                     </ul>
                  </div>
                  <div>
                     <h5 class="font-bold text-lg mb-3">Proyectos y Planificación</h5>
                     <ul class="space-y-2">
                        <li><a  class="whitespace-nowrap" href="{% url 'partner_list' %}" class="link link-hover">Clientes</a></li>
                        <li><a  class="whitespace-nowrap" href="{% url 'project_list' %}" class="link link-hover">Proyectos</a></li>
                        <li><a  class="whitespace-nowrap" href="#" class="link link-hover">Planificación</a></li>
                     </ul>
                  </div>
                  <div>
                     <h5 class="font-bold text-lg mb-3">Reportes y Otros</h5>
                     <ul class="space-y-2">
                        <li><a  class="whitespace-nowrap" href="#" class="link link-hover">Reporte de Mantenimiento</a></li>
                        <li><a  class="whitespace-nowrap" href="#" class="link link-hover">Licencias</a></li>
                     </ul>
                  </div>
               </div>
               <div class="border-t border-neutral-focus pt-2 text-[10px]">
                  <div class="flex flex-col md:flex-row justify-between items-center">
                     <p class="mb-4 md:mb-0">©{% now "Y" %} PEISOL S.A Derechos Reservados</p>
                     <div class="flex items-center space-x-4">
                        <a href="https://dev-7.com/" class="text-info">Desarrollado por dev-7.com</a>
                        <a href="mailto:soluciones@dev-7.com" class="link link-hover flex items-center">
                           <i class="las la-envelope inline-block mr-1 text-xl"></i>
                           <span class="ml-2 text-info">soluciones@dev-7.com</span>
                        </a>
                     </div>
                  </div>
               </div>
            </div>
         </footer>
         {% endif %}
         {% endif %}
         <!-- DataTables y otros scripts opcionales pueden ir aquí si los necesitas -->
         {% block files_footer %}
         <script>
            $(document).ready(function() {
               // Verificar si la tabla tiene filas de datos antes de inicializar DataTables
               var tableRows = $('#datatable tbody tr').length;
               var hasData = tableRows > 0 && !$('#datatable tbody tr').first().find('td[colspan]').length;
               
               if (hasData) {
                  $('#datatable').DataTable({
                     language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'
                     },
                     dom: 'Blfrtip',
                     buttons: [
                        {
                           extend: 'excel',
                           text: '<i class="las la-file-excel text-xl"></i>',
                           className: 'btn btn-secondary border',
                           title: document.title,
                           exportOptions: {
                              columns: ':not(.no-export)'
                           }
                        },
                        {
                           extend: 'pdf',
                           text: '<i class="las la-file-pdf text-xl"></i>',
                           className: 'btn btn-secondary border',
                           title: document.title,
                           exportOptions: {
                              columns: ':not(.no-export)'
                           }
                        },
                        {
                           extend: 'csv',
                           text: '<i class="las la-file-csv text-xl"></i>',
                           className: 'btn btn-secondary border',
                           title: document.title,
                           exportOptions: {
                              columns: ':not(.no-export)'
                           }
                        }
                     ],
                     lengthMenu: [
                        [15, 50, 100, -1],
                        ['15', '50', '100', 'Todos']
                     ]
                  });
               } else {
                  // Si no hay datos, ocultar los botones de exportación
                  $('.dt-buttons').hide();
               }
            });
         </script>
         {% endblock %}
         {% block script %}
         <script>
            document.addEventListener('DOMContentLoaded', function () {
                function handleExclusiveAccordion(detailsElements) {
                    detailsElements.forEach(detail => {
                        detail.addEventListener('toggle', function () {
                            // Cuando un <details> se abre
                            if (this.open) {
                                // Cierra todos los demás <details> en el mismo grupo
                                detailsElements.forEach(otherDetail => {
                                    if (otherDetail !== this && otherDetail.open) {
                                        otherDetail.removeAttribute('open');
                                    }
                                });
                            }
                        });
                    });
                }
    
                // Aplicar al navbar de escritorio
                const desktopNavDetails = document.querySelectorAll('.navbar-center .menu > li > details');
                handleExclusiveAccordion(desktopNavDetails);
    
                // Aplicar al navbar móvil
                // Los <details> están dentro de cada <li> del dropdown-content
                const mobileNavDetails = document.querySelectorAll('.navbar-start .dropdown-content > li > details');
                handleExclusiveAccordion(mobileNavDetails);
            });
         </script>
         {% endblock %}
         {% block script_app %}
         {% endblock %}
      </div>
   </body>
</html>