{% load static %}
<!DOCTYPE html>
<html lang="es" data-theme="corporate">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{{ title_page }}</title>
      <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.png' %}">
      <!-- jQuery y DataTables con las rutas locales -->
      <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
      <link href="{% static 'css/daisyui.min.css' %}" rel="stylesheet" type="text/css" />
      <script src="{% static 'js/tailwind-browser.js' %}"></script>
      <link href="{% static 'css/daisyui-themes.css' %}" rel="stylesheet" type="text/css" />
      <!-- Line Awesome Icons -->
      <link rel="stylesheet" href="{% static 'css/line-awesome.min.css' %}">
      <!-- Vue.js (versión de producción) -->
      <script src="{% static 'js/vue-3.global.prod.js' %}"></script>
      <!-- Datatables correctas -->
      <link href="{% static 'css/jquery.dataTables.min.css' %}" rel="stylesheet" />
      <script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
      
      <!-- Extensiones para exportación -->
      <link href="{% static 'css/buttons.dataTables.min.css' %}" rel="stylesheet" />
      <script src="{% static 'js/dataTables.buttons.min.js' %}"></script>
      <script src="{% static 'js/jszip.min.js' %}"></script>
      <script src="{% static 'js/pdfmake.min.js' %}"></script>
      <script src="{% static 'js/vfs_fonts.js' %}"></script>
      <script src="{% static 'js/buttons.html5.min.js' %}"></script>
      <script src="{% static 'js/buttons.print.min.js' %}"></script>
      {% block style%}
      {% endblock %}
      {% block files_header %}
      {% endblock %}
   </head>
   <style>
      table {
    border: 1px solid #d1d5db; /* gray-300 */
    border-collapse: collapse;
  }
  table th, table td {
    padding: 0.25rem; /* padding-1 */
    border: 1px solid #d1d5db; /* gray-300 */
  }
  
  /* Sobrescribir padding de DataTables */
  table.dataTable thead th,
  table.dataTable thead td,
  table.dataTable tbody th,
  table.dataTable tbody td {
    padding: 0.25rem !important; /* padding-1 */
  }
   </style>
   <body class="flex flex-col min-h-screen">

      <div id="app" class="flex flex-col flex-grow">
         {% if title_page != 'Inicio Sesion' %}
         {% if not popup_window %}
         <!-- Nuevo Navbar Responsivo para Items de Menú -->
         <div class="navbar bg-base-100 shadow-lg mb-1 min-h-[3rem] h-14">
            <div class="navbar-start">
               <div class="dropdown">
                  <label tabindex="0" class="btn btn-ghost btn-sm lg:hidden">
                     <i class="las la-bars text-xl"></i>
                  </label>
                  <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1000] p-2 shadow bg-base-100 rounded-box w-52">
                     <!-- Equipos -->
                     <li>
                        <details>
                           <summary>Equipos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'resource_list' %}"><i class="las la-list mr-2"></i>Listar Equipos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'resource_create' %}"><i class="las la-plus mr-2"></i>Crear Equipo</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'purge_equipment' %}"><i class="las la-check-double mr-2"></i>Verificación</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Vehículos -->
                     <li>
                        <details>
                           <summary>Vehículos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'vehicle_list' %}"><i class="las la-list mr-2"></i>Listar Vehículos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'vehicle_create' %}"><i class="las la-plus mr-2"></i>Crear Vehículo</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Técnicos -->
                     <li>
                        <details>
                           <summary>Técnicos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'technical_list' %}"><i class="las la-list mr-2"></i>Listar Técnicos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'technical_create' %}"><i class="las la-user-plus mr-2"></i>Crear Técnico</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Proyectos -->
                     <li>
                        <details>
                           <summary>Proyectos</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="{% url 'partner_list' %}"><i class="las la-handshake mr-2"></i>Listar Clientes</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'project_list' %}"><i class="las la-list mr-2"></i>Listar Proyectos</a></li>
                              <li><a  class="whitespace-nowrap" href="{% url 'project_create' %}"><i class="las la-plus mr-2"></i>Crear Proyecto</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Planificación -->
                     <li>
                        <details>
                           <summary>Planificación</summary>
                           <ul class="p-2">
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-eye mr-2"></i>Ver Planificación</a></li>
                              <li><a  class="whitespace-nowrap" href="#"><i class="las la-plus mr-2"></i>Crear Planificación</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Reportes -->
                     <li>
                        <details>
                           <summary>Reportes</summary>
                           <ul class="p-2">
                              <li><a class="whitespace-nowrap" href="{% url 'equipment-status-report' %}"><i class="las la-clipboard-list mr-2"></i>Equipos por Estado</a></li>
                              <li><a class="whitespace-nowrap" href="{% url 'vehicles-status-report' %}"><i class="las la-truck mr-2"></i>Vehículos por Estado</a></li>
                              <li><a class="whitespace-nowrap" href="{% url 'technicals-status-report' %}"><i class="las la-users mr-2"></i>Técnicos por Estado</a></li>
                           </ul>
                        </details>
                     </li>
                     <li><div class="divider my-1"></div></li>
                     <!-- Usuario para móvil -->
                     <li>
                        <details>
                           <summary>
                              <i class="las la-user mr-2"></i>
                              {{ user.get_full_name|default:user.email }}
                           </summary>
                           <ul class="p-2">
                              <li><a class="whitespace-nowrap" href="{% url 'profile' %}"><i class="las la-user mr-2"></i>Mi Perfil</a></li>
                              <li><a class="whitespace-nowrap" href="{% url 'profile_edit' %}"><i class="las la-edit mr-2"></i>Editar Perfil</a></li>
                              <li><a class="whitespace-nowrap" href="#" onclick="openChangePasswordModal(); return false;"><i class="las la-key mr-2"></i>Cambiar Contraseña</a></li>
                           </ul>
                        </details>
                     </li>
                     <!-- Salir para móvil -->
                     <li>
                        <a class="text-error border border-black" href="{% url 'logout' %}">
                           <i class="las la-sign-out-alt mr-2"></i>
                           Salir
                        </a>
                     </li>
                  </ul>
               </div>
               <a class="btn btn-ghost btn-sm normal-case text-lg" href="{% url 'home' %}">
                  <img src="/static/img/logo.png" alt="Logo" class="h-7 rounded" />
               </a>
            </div>
            <div class="navbar-center hidden lg:flex">
               <ul class="menu menu-horizontal menu-sm px-1">
                  <!-- Equipos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-desktop inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Equipos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'resource_list' %}"><i class="las la-list mr-2"></i>Listar Equipos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'resource_create' %}"><i class="las la-plus mr-2"></i>Crear Equipo</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'purge_equipment' %}"><i class="las la-check-double mr-2"></i>Verificación</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Vehículos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-truck inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Vehículos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'vehicle_list' %}"><i class="las la-list mr-2"></i>Listar Vehículos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'vehicle_create' %}"><i class="las la-plus mr-2"></i>Crear Vehículo</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Técnicos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-users inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Técnicos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'technical_list' %}"><i class="las la-list mr-2"></i>Listar Técnicos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'technical_create' %}"><i class="las la-user-plus mr-2"></i>Crear Técnico</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Proyectos -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-project-diagram inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Proyectos</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'partner_list' %}"><i class="las la-handshake mr-2"></i>Listar Clientes</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'project_list' %}"><i class="las la-list mr-2"></i>Listar Proyectos</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'project_create' %}"><i class="las la-plus mr-2"></i>Crear Proyecto</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Planificación -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-calendar inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Planificación</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-eye mr-2"></i>Ver Planificación</a></li>
                           <li><a  class="whitespace-nowrap bg-base-100 text-sm" href="#"><i class="las la-plus mr-2"></i>Crear Planificación</a></li>
                        </ul>
                     </details>
                  </li>
                  <!-- Reportes -->
                  <li>
                     <details>
                        <summary class="py-2">
                           <i class="las la-chart-bar inline-block mr-1 text-lg"></i>
                           <span class="text-sm">Reportes</span>
                        </summary>
                        <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50">
                           <li><a class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'equipment-status-report' %}"><i class="las la-clipboard-list mr-2"></i>Equipos por Estado</a></li>
                           <li><a class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'vehicles-status-report' %}"><i class="las la-truck mr-2"></i>Vehículos por Estado</a></li>
                           <li><a class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'technicals-status-report' %}"><i class="las la-users mr-2"></i>Técnicos por Estado</a></li>
                        </ul>
                     </details>
                  </li>
               </ul>
            </div>
            <div class="navbar-end hidden lg:flex">
                <ul class="menu menu-horizontal menu-sm px-1">
                    <!-- Dropdown de Usuario -->
                    <li>
                        <details>
                           <summary class="py-2">
                              <div class="flex items-center gap-2">
                                 <div class="avatar placeholder">
                                    <div class="bg-neutral text-neutral-content rounded-full w-8">
                                       <span class="text-xs">{{ user.first_name.0|default:"U" }}{{ user.last_name.0|default:"" }}</span>
                                    </div>
                                 </div>
                                 <span class="text-sm">{{ user.get_full_name|default:user.username }}</span>
                              </div>
                           </summary>
                           <ul class="p-2 bg-base-100 z-[1000] shadow rounded-box bg-gray-50 w-52">
                              <li>
                                 <a class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'profile' %}">
                                    <i class="las la-user mr-2"></i>Mi Perfil
                                 </a>
                              </li>
                              <li>
                                 <a class="whitespace-nowrap bg-base-100 text-sm" href="{% url 'profile_edit' %}">
                                    <i class="las la-edit mr-2"></i>Editar Perfil
                                 </a>
                              </li>
                              <li>
                                 <a class="whitespace-nowrap bg-base-100 text-sm" href="#" onclick="openChangePasswordModal(); return false;">
                                    <i class="las la-key mr-2"></i>Cambiar Contraseña
                                 </a>
                              </li>
                              <li class="border-t border-base-300 mt-2 pt-2">
                                 <a class="whitespace-nowrap bg-base-100 text-error text-sm" href="{% url 'logout' %}">
                                    <i class="las la-sign-out-alt mr-2"></i>Salir
                                 </a>
                              </li>
                           </ul>
                        </details>
                     </li>
                </ul>
            </div>
         </div>
         {% endif %}
         {% if show_alert  %}
         <div class="container mx-auto">
            <div class="alert alert-warning" role="alert">
               Esta es una alerta del sistema
            </div>
         </div>
         {% endif %}
         {% if show_toolbar %}
         <div class="container mx-auto bg-base-200 m-1 p-1">
            <div class="flex gap-2">
               <div class="flex-1">Column</div>
               <div class="flex-1">Column</div>
               <div class="flex-1">Column</div>
            </div>
         </div>
         {% endif %}
         {% endif %}
         
         <main class="flex-grow">
            {% if title_page != 'Inicio Sesion' %}
            {% if show_alert  %}
            <div class="container mx-auto">
               <div class="alert alert-warning" role="alert">
                  Esta es una alerta del sistema
               </div>
            </div>
            {% endif %}
            {% if show_toolbar %}
            <div class="container mx-auto bg-base-200 m-1 p-1">
               <div class="flex gap-2">
                  <div class="flex-1">Column</div>
                  <div class="flex-1">Column</div>
                  <div class="flex-1">Column</div>
               </div>
            </div>
            {% endif %}
            {% endif %}
            {% block content %}
            {% endblock %}
         </main>

         {% if title_page != 'Inicio Sesion' %}
         {% if not popup_window %}
         <footer class="bg-zinc-700 text-base-100 mt-10 py-10">
            <div class="container mx-auto px-4">
               <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                  <div>
                     <h5 class="font-bold text-lg mb-3">Navegación</h5>
                     <ul class="space-y-2">
                        <li><a  class="whitespace-nowrap" href="{% url 'resource_list' %}" class="link link-hover">Equipos</a></li>
                        <li><a  class="whitespace-nowrap" href="{% url 'vehicle_list' %}" class="link link-hover">Vehículos</a></li>
                        <li><a  class="whitespace-nowrap" href="{% url 'technical_list' %}" class="link link-hover">Técnicos</a></li>
                     </ul>
                  </div>
                  <div>
                     <h5 class="font-bold text-lg mb-3">Proyectos y Planificación</h5>
                     <ul class="space-y-2">
                        <li><a  class="whitespace-nowrap" href="{% url 'partner_list' %}" class="link link-hover">Clientes</a></li>
                        <li><a  class="whitespace-nowrap" href="{% url 'project_list' %}" class="link link-hover">Proyectos</a></li>
                        <li><a  class="whitespace-nowrap" href="#" class="link link-hover">Planificación</a></li>
                     </ul>
                  </div>
                  <div>
                     <h5 class="font-bold text-lg mb-3">Reportes</h5>
                     <ul class="space-y-2">
                        <li><a class="whitespace-nowrap" href="{% url 'equipment-status-report' %}" class="link link-hover">Equipos por Estado</a></li>
                        <li><a class="whitespace-nowrap" href="{% url 'vehicles-status-report' %}" class="link link-hover">Vehículos por Estado</a></li>
                        <li><a class="whitespace-nowrap" href="{% url 'technicals-status-report' %}" class="link link-hover">Técnicos por Estado</a></li>
                     </ul>
                  </div>
               </div>
               <div class="border-t border-neutral-focus pt-2 text-[10px]">
                  <div class="flex flex-col md:flex-row justify-between items-center">
                     <p class="mb-4 md:mb-0">©{% now "Y" %} PEISOL S.A Derechos Reservados</p>
                     <div class="flex items-center space-x-4">
                        <a href="https://dev-7.com/" class="text-info">Desarrollado por dev-7.com</a>
                        <a href="mailto:soluciones@dev-7.com" class="link link-hover flex items-center">
                           <i class="las la-envelope inline-block mr-1 text-xl"></i>
                           <span class="ml-2 text-info">soluciones@dev-7.com</span>
                        </a>
                     </div>
                  </div>
               </div>
            </div>
         </footer>
         {% endif %}
         {% endif %}
         <!-- DataTables y otros scripts opcionales pueden ir aquí si los necesitas -->
         {% block files_footer %}
         <script>
            $(document).ready(function() {
               // Verificar si la tabla tiene filas de datos antes de inicializar DataTables
               var tableRows = $('#datatable tbody tr').length;
               var hasData = tableRows > 0 && !$('#datatable tbody tr').first().find('td[colspan]').length;
               
               if (hasData) {
                  $('#datatable').DataTable({
                     language: {
                        url: "{% static 'i18n/es-ES.json' %}"
                     },
                     dom: 'Blfrtip',
                     buttons: [
                        {
                           extend: 'excel',
                           text: '<i class="las la-file-excel text-xl"></i>',
                           className: 'btn btn-secondary border',
                           title: document.title,
                           exportOptions: {
                              columns: ':not(.no-export)'
                           }
                        },
                        {
                           extend: 'pdf',
                           text: '<i class="las la-file-pdf text-xl"></i>',
                           className: 'btn btn-secondary border',
                           title: document.title,
                           exportOptions: {
                              columns: ':not(.no-export)'
                           }
                        },
                        {
                           extend: 'csv',
                           text: '<i class="las la-file-csv text-xl"></i>',
                           className: 'btn btn-secondary border',
                           title: document.title,
                           exportOptions: {
                              columns: ':not(.no-export)'
                           }
                        }
                     ],
                     lengthMenu: [
                        [15, 50, 100, -1],
                        ['15', '50', '100', 'Todos']
                     ]
                  });
               } else {
                  // Si no hay datos, ocultar los botones de exportación
                  $('.dt-buttons').hide();
               }
            });
         </script>
         {% endblock %}
         {% block script %}
         <script>
            document.addEventListener('DOMContentLoaded', function () {
                function handleExclusiveAccordion(detailsElements) {
                    detailsElements.forEach(detail => {
                        detail.addEventListener('toggle', function () {
                            // Cuando un <details> se abre
                            if (this.open) {
                                // Cierra todos los demás <details> en el mismo grupo
                                detailsElements.forEach(otherDetail => {
                                    if (otherDetail !== this && otherDetail.open) {
                                        otherDetail.removeAttribute('open');
                                    }
                                });
                            }
                        });
                    });
                }
    
                // Aplicar al navbar de escritorio
                const desktopNavDetails = document.querySelectorAll('.navbar-center .menu > li > details');
                handleExclusiveAccordion(desktopNavDetails);
    
                // Aplicar al navbar móvil
                // Los <details> están dentro de cada <li> del dropdown-content
                const mobileNavDetails = document.querySelectorAll('.navbar-start .dropdown-content > li > details');
                handleExclusiveAccordion(mobileNavDetails);
            });
         </script>
         {% endblock %}
         {% block script_app %}
         {% endblock %}
      </div>

      <!-- Modal para cambio de contraseña (global) -->
      {% if user.is_authenticated %}
      <dialog id="changePasswordModal" class="modal">
         <div class="modal-box">
            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
               <i class="las la-key"></i>
               Cambiar Contraseña
            </h3>
            
            <!-- Área de mensajes -->
            <div id="passwordChangeMessages" class="hidden mb-4"></div>
            
            <!-- Contenedor del formulario -->
            <div id="passwordFormContainer">
               <div class="flex justify-center">
                  <span class="loading loading-spinner loading-lg"></span>
               </div>
            </div>
         </div>
         <form method="dialog" class="modal-backdrop">
            <button>close</button>
         </form>
      </dialog>

      <script>
         // Variables globales para el modal de cambio de contraseña
         const changePasswordModal = document.getElementById('changePasswordModal');
         const passwordFormContainer = document.getElementById('passwordFormContainer');
         const passwordChangeMessages = document.getElementById('passwordChangeMessages');
         
         // Función para abrir el modal de cambio de contraseña
         function openChangePasswordModal() {
            if (!changePasswordModal) return;
            
            // Mostrar el modal
            changePasswordModal.showModal();
            
            // Limpiar mensajes previos
            hidePasswordMessages();
            
            // Mostrar loading
            passwordFormContainer.innerHTML = `
               <div class="flex justify-center py-8">
                  <span class="loading loading-spinner loading-lg"></span>
               </div>
            `;
            
            // Cargar el formulario por AJAX
            fetch('{% url "change_password" %}', {
               method: 'GET',
               headers: {
                  'X-Requested-With': 'XMLHttpRequest',
                  'Content-Type': 'application/json'
               }
            })
            .then(response => response.json())
            .then(data => {
               if (data.success) {
                  passwordFormContainer.innerHTML = data.form_html;
                  setupPasswordFormSubmit();
               } else {
                  showPasswordMessage('Error al cargar el formulario.', 'error');
               }
            })
            .catch(error => {
               console.error('Error:', error);
               showPasswordMessage('Error de conexión.', 'error');
            });
         }
         
         // Función para cerrar el modal
         function closeChangePasswordModal() {
            if (changePasswordModal) {
               changePasswordModal.close();
            }
         }
         
         // Configurar el envío del formulario por AJAX
         function setupPasswordFormSubmit() {
            const form = document.getElementById('changePasswordForm');
            if (!form) return;
            
            form.addEventListener('submit', function(e) {
               e.preventDefault();
               
               // Limpiar errores previos
               clearPasswordFormErrors();
               hidePasswordMessages();
               
               // Obtener los datos del formulario
               const formData = new FormData(form);
               
               // Enviar por AJAX
               fetch('{% url "change_password" %}', {
                  method: 'POST',
                  body: formData,
                  headers: {
                     'X-Requested-With': 'XMLHttpRequest',
                  }
               })
               .then(response => response.json())
               .then(data => {
                  if (data.success) {
                     showPasswordMessage(data.message, 'success');
                     // Cerrar el modal después de 2 segundos
                     setTimeout(() => {
                        closeChangePasswordModal();
                        // Recargar la página para actualizar la sesión
                        window.location.reload();
                     }, 2000);
                  } else {
                     showPasswordMessage(data.message || 'Error al cambiar contraseña', 'error');
                     if (data.errors) {
                        showPasswordFormErrors(data.errors);
                     }
                  }
               })
               .catch(error => {
                  console.error('Error:', error);
                  showPasswordMessage('Error de conexión.', 'error');
               });
            });
         }
         
         // Mostrar mensajes en el modal
         function showPasswordMessage(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const icon = type === 'success' ? 'la-check-circle' : 'la-exclamation-triangle';
            
            passwordChangeMessages.innerHTML = `
               <div class="alert ${alertClass}">
                  <i class="las ${icon}"></i>
                  <span>${message}</span>
               </div>
            `;
            passwordChangeMessages.classList.remove('hidden');
         }
         
         // Ocultar mensajes
         function hidePasswordMessages() {
            if (passwordChangeMessages) {
               passwordChangeMessages.classList.add('hidden');
               passwordChangeMessages.innerHTML = '';
            }
         }
         
         // Mostrar errores específicos de campos
         function showPasswordFormErrors(errors) {
            for (const [fieldName, errorMessages] of Object.entries(errors)) {
               const errorContainer = document.getElementById(`${fieldName}_errors`);
               if (errorContainer) {
                  const textElement = errorContainer.querySelector('.label-text-alt');
                  if (textElement) {
                     textElement.textContent = errorMessages.join(', ');
                  }
                  errorContainer.classList.remove('hidden');
               }
            }
         }
         
         // Limpiar errores de campos
         function clearPasswordFormErrors() {
            const errorContainers = document.querySelectorAll('[id$="_errors"]');
            errorContainers.forEach(container => {
               container.classList.add('hidden');
               const textElement = container.querySelector('.label-text-alt');
               if (textElement) textElement.textContent = '';
            });
         }
         
         // Función para obtener el token CSRF
         function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
               const cookies = document.cookie.split(';');
               for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                     cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                     break;
                  }
               }
            }
            return cookieValue;
         }
      </script>
      {% endif %}
   </body>
</html>