{% extends 'base/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-md border border-t-[15px] border-t-blue-500">
  <div class="flex justify-between items-center border-b-blue-500 border-b pb-1 mb-3">
    <h1 class="text-2xl font-semibold text-blue-500">
      {% if object.pk %}Editar Técnico{% else %}Nuevo Técnico{% endif %}
    </h1>
    <div class="text-gray-500">
      <div class="flex flex-wrap gap-3">
        {% if object.pk %}
        <a href="{% url 'technical_detail' object.id %}" class="btn btn-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1" width="12" height="12" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 6l-6 6l6 6" />
          </svg>
          Ver Detalle
        </a>
        {% endif %}
        <a href="{% url 'technical_list' %}" class="btn btn-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1" width="12" height="12" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 6l-6 6l6 6" />
          </svg>
          Cancelar
        </a>
      </div>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <!-- Mostrar errores generales del formulario -->
    {% if form.non_field_errors %}
      <div class="alert alert-error mb-4">
        {{ form.non_field_errors }}
      </div>
    {% endif %}
    
    <!-- Tabs para organizar el formulario -->
    <div class="tabs tabs-box w-full mb-4">
      <input type="radio" name="form_tabs" class="tab" aria-label="Información Personal" checked />
      <div class="tab-content bg-base-100 border-base-300 p-6">
        
        <!-- Estados y Afiliaciones - Parte Superior -->
        <div class="mb-6 p-1 border rounded-lg border-gray-200">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors duration-200">
                {{ form.is_active }}
                <span class="label-text font-medium text-gray-700">{{ form.is_active.label }}</span>
              </label>
            </div>
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors duration-200">
                {{ form.is_iess_affiliated }}
                <span class="label-text font-medium text-gray-700">{{ form.is_iess_affiliated.label }}</span>
              </label>
            </div>
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors duration-200">
                {{ form.has_life_insurance_policy }}
                <span class="label-text font-medium text-gray-700">{{ form.has_life_insurance_policy.label }}</span>
              </label>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Datos Personales -->
          <div class="space-y-4 border-l-blue-300 border-l-[1px] pl-5">
            <h3 class="text-lg font-medium text-blue-600 mb-4">Datos Personales</h3>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.first_name.label }}</span>
              </label>
              {{ form.first_name }}
              {% if form.first_name.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.first_name.errors.0 }}</span>
                </div>
              {% endif %}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.last_name.label }}</span>
              </label>
              {{ form.last_name }}
              {% if form.last_name.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.last_name.errors.0 }}</span>
                </div>
              {% endif %}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.dni.label }}</span>
              </label>
              {{ form.dni }}
              {% if form.dni.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.dni.errors.0 }}</span>
                </div>
              {% endif %}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.birth_date.label }}</span>
                <span id="ageDisplay" class="badge badge-info badge-soft" style="display: none;"></span>
              </label>
              {{ form.birth_date }}
              {% if form.birth_date.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.birth_date.errors.0 }}</span>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Datos de Contacto y Trabajo -->
          <div class="space-y-4 border-l-blue-300 border-l-[1px] pl-5">
            <h3 class="text-lg font-medium text-blue-600 mb-4">Contacto y Trabajo</h3>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.email.label }}</span>
              </label>
              {{ form.email }}
              {% if form.email.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.email.errors.0 }}</span>
                </div>
              {% endif %}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.nro_phone.label }}</span>
              </label>
              {{ form.nro_phone }}
              {% if form.nro_phone.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.nro_phone.errors.0 }}</span>
                </div>
              {% endif %}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.work_area.label }}</span>
              </label>
              {{ form.work_area }}
              {% if form.work_area.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.work_area.errors.0 }}</span>
                </div>
              {% endif %}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.date_joined.label }}</span>
              </label>
              {{ form.date_joined }}
              {% if form.date_joined.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.date_joined.errors.0 }}</span>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <input type="radio" name="form_tabs" class="tab" aria-label="Certificados" />
      <div class="tab-content bg-base-100 border-base-300 p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Licencia de Conducir -->
          <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 relative">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-lg font-medium text-blue-600">Licencia de Conducir</h3>
              <span id="licenseExpiryBadge" class="badge badge-soft" style="display: none;"></span>
            </div>
            
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">{{ form.license_issue_date.label }}</span>
              </label>
              {{ form.license_issue_date }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.license_expiry_date.label }}</span>
              </label>
              {{ form.license_expiry_date }}
            </div>
          </div>

          <!-- Certificado de Manejo Defensivo -->
          <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 relative">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-lg font-medium text-blue-600">Manejo Defensivo</h3>
              <span id="defensiveDrivingExpiryBadge" class="badge badge-soft" style="display: none;"></span>
            </div>
            
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">{{ form.defensive_driving_certificate_issue_date.label }}</span>
              </label>
              {{ form.defensive_driving_certificate_issue_date }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.defensive_driving_certificate_expiry_date.label }}</span>
              </label>
              {{ form.defensive_driving_certificate_expiry_date }}
            </div>
          </div>

          <!-- Certificado MAE -->
          <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 relative">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-lg font-medium text-blue-600">Certificado MAE</h3>
              <span id="maeExpiryBadge" class="badge badge-soft" style="display: none;"></span>
            </div>
            
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">{{ form.mae_certificate_issue_date.label }}</span>
              </label>
              {{ form.mae_certificate_issue_date }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.mae_certificate_expiry_date.label }}</span>
              </label>
              {{ form.mae_certificate_expiry_date }}
            </div>
          </div>

          <!-- Certificado Médico -->
          <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 relative">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-lg font-medium text-blue-600">Certificado Médico</h3>
              <span id="medicalExpiryBadge" class="badge badge-soft" style="display: none;"></span>
            </div>
            
            <div class="form-control mb-3">
              <label class="label">
                <span class="label-text">{{ form.medical_certificate_issue_date.label }}</span>
              </label>
              {{ form.medical_certificate_issue_date }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.medical_certificate_expiry_date.label }}</span>
              </label>
              {{ form.medical_certificate_expiry_date }}
            </div>
          </div>
        </div>
      </div>

      <input type="radio" name="form_tabs" class="tab" aria-label="Quest & Notas" />
      <div class="tab-content bg-base-100 border-base-300 p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Información Quest -->
          <div class="space-y-4 border-l-blue-300 border-l-[1px] pl-5">
            <h3 class="text-lg font-medium text-blue-600 mb-4">Certificación Quest</h3>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.quest_ncst_code.label }}</span>
              </label>
              {{ form.quest_ncst_code }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.quest_instructor.label }}</span>
              </label>
              {{ form.quest_instructor }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.quest_start_date.label }}</span>
              </label>
              {{ form.quest_start_date }}
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">{{ form.quest_end_date.label }}</span>
              </label>
              {{ form.quest_end_date }}
            </div>
          </div>

          <!-- Notas -->
          <div class="space-y-4 border-l-blue-300 border-l-[1px] pl-5">
            <h3 class="text-lg font-medium text-blue-600 mb-4">Notas y Observaciones</h3>
            
            <div class="form-control">
              <label class="label pb-2">
                <span class="label-text text-sm font-semibold text-gray-700">{{ form.notes.label }}</span>
                <span class="label-text-alt text-gray-500 text-xs">Información adicional</span>
              </label>
              {{ form.notes }}
              {% if form.notes.errors %}
                <div class="label">
                  <span class="label-text-alt text-error">{{ form.notes.errors.0 }}</span>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <input type="radio" name="form_tabs" class="tab" aria-label="Pases y Vacunas" />
      <div class="tab-content bg-base-100 border-base-300 p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          
          <!-- Registros de Vacunación -->
          <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
            <div class="border-b border-gray-200 p-4">
              <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-700">Registros de Vacunación</h3>
                <button type="button" 
                        class="btn btn-primary btn-sm"
                        onclick="openVaccinationModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  Agregar Vacuna
                </button>
              </div>
            </div>
            <div class="p-4">
              <!-- Lista de vacunas existentes -->
              {% if object and object.vaccination_records.all %}
                <div id="existingVaccinations" class="space-y-3 mb-4">
                  {% for vaccination in object.vaccination_records.all %}
                    <div class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors">
                      <div class="flex justify-between items-start">
                        <div>
                          <h4 class="font-medium text-gray-800">{{ vaccination.get_vaccine_type_display }}</h4>
                          <p class="text-sm text-gray-600 mt-1">
                            <span class="font-medium">Aplicada:</span> 
                            {{ vaccination.application_date|date:"d/m/Y" }}
                          </p>
                          {% if vaccination.dose_number %}
                            <p class="text-sm text-gray-600">
                              <span class="font-medium">Dosis:</span> {{ vaccination.dose_number }}
                            </p>
                          {% endif %}
                          {% if vaccination.next_dose_date %}
                            <p class="text-sm text-gray-600">
                              <span class="font-medium">Próxima dosis:</span> {{ vaccination.next_dose_date|date:"d/m/Y" }}
                            </p>
                          {% endif %}
                          {% if vaccination.batch_number %}
                            <p class="text-xs text-gray-500 mt-1">Lote: {{ vaccination.batch_number }}</p>
                          {% endif %}
                        </div>
                        <div class="flex gap-1">
                          <button type="button" class="btn btn-ghost btn-xs text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                          </button>
                          <button type="button" class="btn btn-ghost btn-xs text-red-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
              
              <!-- Lista de vacunas temporales (pendientes de guardar) -->
              <div id="tempVaccinationsList" class="space-y-3">
                <!-- Las vacunas temporales se agregan aquí dinámicamente -->
              </div>
              
              <!-- Mensaje cuando no hay vacunas -->
              <div id="noVaccinationsMessage" class="text-center py-8" style="display: {% if object and object.vaccination_records.all %}none{% else %}block{% endif %};">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto text-gray-400 mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
                </svg>
                <p class="text-gray-500 text-sm">No hay vacunas registradas</p>
                <p class="text-gray-400 text-xs mt-1">Haz clic en "Agregar Vacuna" para comenzar</p>
              </div>
            </div>
          </div>

          <!-- Pases del Técnico -->
          <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
            <div class="border-b border-gray-200 p-4">
              <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-700">Pases del Técnico</h3>
                <button type="button" 
                        class="btn btn-primary btn-sm"
                        onclick="openTechnicalPassModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  Agregar Pase
                </button>
              </div>
            </div>
            <div class="p-4">
              <!-- Lista de pases existentes -->
              {% if object and object.passtechnical_set.all %}
                <div id="existingPasses" class="space-y-3 mb-4">
                  {% for pass in object.passtechnical_set.all %}
                    <div class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors">
                      <div class="flex justify-between items-start">
                        <div>
                          <h4 class="font-medium text-gray-800">{{ pass.get_bloque_display }}</h4>
                          <p class="text-sm text-gray-600 mt-1">
                            <span class="font-medium">Vence:</span> 
                            {{ pass.fecha_caducidad|date:"d/m/Y" }}
                          </p>
                          <div class="mt-2">
                            {% now "Y-m-d" as today %}
                            {% if pass.fecha_caducidad|timeuntil < "30 days" %}
                              <span class="badge badge-warning badge-sm">Por vencer</span>
                            {% elif pass.fecha_caducidad < today %}
                              <span class="badge badge-error badge-sm">Vencido</span>
                            {% else %}
                              <span class="badge badge-success badge-sm">Vigente</span>
                            {% endif %}
                          </div>
                        </div>
                        <div class="flex gap-1">
                          <button type="button" class="btn btn-ghost btn-xs text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                          </button>
                          <button type="button" class="btn btn-ghost btn-xs text-red-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
              
              <!-- Lista de pases temporales (pendientes de guardar) -->
              <div id="tempPassesList" class="space-y-3">
                <!-- Los pases temporales se agregan aquí dinámicamente -->
              </div>
              
              <!-- Mensaje cuando no hay pases -->
              <div id="noPassesMessage" class="text-center py-8" style="display: {% if object and object.passtechnical_set.all %}none{% else %}block{% endif %};">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto text-gray-400 mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5zm6-10.125a1.875 1.875 0 11-3.75 0 1.875 1.875 0 013.75 0z"/>
                </svg>
                <p class="text-gray-500 text-sm">No hay pases registrados</p>
                <p class="text-gray-400 text-xs mt-1">Haz clic en "Agregar Pase" para comenzar</p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Campos ocultos para almacenar datos temporales -->
    {{ form.vaccinations_data }}
    {{ form.passes_data }}

    <!-- Botones de acción -->
    <div class="flex flex-wrap justify-center gap-2 mt-6 border-t pt-4">
      <button type="submit" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-device-floppy">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"/>
          <path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
          <path d="M14 4l0 4l-6 0l0 -4"/>
        </svg>
        {% if object.pk %}Actualizar{% else %}Crear{% endif %} Técnico
      </button>
      <a href="{% url 'technical_list' %}" class="btn btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1" width="12" height="12" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M9 6l-6 6l6 6" />
        </svg>
        Cancelar
      </a>
    </div>
  </form>
</div>

<!-- Modal para Registros de Vacunación -->
<div id="vaccinationModal" class="modal">
  <div class="modal-box w-11/12 max-w-2xl">
    <div class="flex justify-between items-center border-b pb-3 mb-4">
      <h3 class="font-bold text-lg text-gray-800">Agregar Registro de Vacunación</h3>
      <button type="button" class="btn btn-sm btn-circle btn-ghost" onclick="closeVaccinationModal()">✕</button>
    </div>
    
    <form id="vaccinationForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        
        <!-- Tipo de Vacuna -->
        <div class="form-control md:col-span-2">
          <label class="label">
            <span class="label-text font-semibold">Tipo de Vacuna</span>
          </label>
          <select name="vaccine_type" class="select select-bordered w-full" required>
            <option value="">Seleccione una vacuna</option>
            <option value="HEPATITIS_A_B">Hepatitis A y B</option>
            <option value="TETANUS">Tétanos</option>
            <option value="TYPHOID">Tifoidea</option>
            <option value="YELLOW_FEVER">Fiebre Amarilla</option>
            <option value="INFLUENZA">Influenza</option>
            <option value="MEASLES">Sarampión</option>
            <option value="COVID">Covid-19</option>
            <option value="OTHER">Otra</option>
          </select>
        </div>

        <!-- Fecha de Aplicación -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Fecha de Aplicación</span>
          </label>
          <input type="date" name="application_date" class="input input-bordered w-full" required>
        </div>

        <!-- Número de Dosis -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Número de Dosis</span>
          </label>
          <input type="number" name="dose_number" class="input input-bordered w-full" min="1" placeholder="1, 2, 3...">
        </div>

        <!-- Número de Lote -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Número de Lote</span>
          </label>
          <input type="text" name="batch_number" class="input input-bordered w-full" placeholder="Número de lote">
        </div>

        <!-- Fecha Próxima Dosis -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Fecha Próxima Dosis</span>
          </label>
          <input type="date" name="next_dose_date" class="input input-bordered w-full">
        </div>

        <!-- Notas -->
        <div class="form-control md:col-span-2">
          <label class="label">
            <span class="label-text font-semibold">Notas Adicionales</span>
          </label>
          <textarea name="notes" class="textarea textarea-bordered w-full min-h-20" placeholder="Observaciones sobre la vacunación (opcional)"></textarea>
        </div>

      </div>

      <div class="modal-action">
        <button type="button" class="btn btn-secondary" onclick="closeVaccinationModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar Vacunación</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal para Pases del Técnico -->
<div id="technicalPassModal" class="modal">
  <div class="modal-box w-11/12 max-w-xl">
    <div class="flex justify-between items-center border-b pb-3 mb-4">
      <h3 class="font-bold text-lg text-gray-800">Agregar Pase del Técnico</h3>
      <button type="button" class="btn btn-sm btn-circle btn-ghost" onclick="closeTechnicalPassModal()">✕</button>
    </div>
    
    <form id="technicalPassForm" class="space-y-4">
      
      <!-- Bloque -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-semibold">Bloque</span>
        </label>
        <select name="bloque" class="select select-bordered w-full" required>
          <option value="">Seleccione un bloque</option>
          <option value="petroecuador">Tarjeta de Petroecuador</option>
          <option value="shaya">Shaya</option>
          <option value="consorcio_shushufindi">Consorcio Shushufindi</option>
          <option value="enap_sipec">ENAP SIPEC</option>
          <option value="orion">Tarjeta Orion</option>
          <option value="andes_petroleum">Andes Petroleum</option>
          <option value="pardalis_services">Pardalis Services</option>
          <option value="frontera_energy">Frontera Energy</option>
          <option value="gran_tierra">Gran Tierra</option>
          <option value="pcr">PCR</option>
          <option value="halliburton">Halliburton</option>
          <option value="gente_oil">Gente Oil</option>
          <option value="tribiol_gas">Tribiol Gas</option>
          <option value="adico">Adico</option>
          <option value="cuyaveno_petro">Cuyaveno Petro</option>
          <option value="geopark">Geopark</option>
        </select>
      </div>

      <!-- Fecha de Caducidad -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-semibold">Fecha de Caducidad</span>
        </label>
        <input type="date" name="fecha_caducidad" class="input input-bordered w-full" required>
      </div>

      <div class="modal-action">
        <button type="button" class="btn btn-secondary" onclick="closeTechnicalPassModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar Pase</button>
      </div>
    </form>
  </div>
</div>

<script>
// Arrays temporales para almacenar datos antes de guardar
let tempVaccinations = [];
let tempPasses = [];

// Diccionario para traducir tipos de vacunas
const vaccineTypeLabels = {
  'HEPATITIS_A_B': 'Hepatitis A y B',
  'TETANUS': 'Tétanos',
  'TYPHOID': 'Tifoidea',
  'YELLOW_FEVER': 'Fiebre Amarilla',
  'INFLUENZA': 'Influenza',
  'MEASLES': 'Sarampión',
  'COVID': 'Covid-19',
  'OTHER': 'Otra'
};

// Diccionario para traducir bloques
const bloqueLabels = {
  'petroecuador': 'Tarjeta de Petroecuador',
  'shaya': 'Shaya',
  'consorcio_shushufindi': 'Consorcio Shushufindi',
  'enap_sipec': 'ENAP SIPEC',
  'orion': 'Tarjeta Orion',
  'andes_petroleum': 'Andes Petroleum',
  'pardalis_services': 'Pardalis Services',
  'frontera_energy': 'Frontera Energy',
  'gran_tierra': 'Gran Tierra',
  'pcr': 'PCR',
  'halliburton': 'Halliburton',
  'gente_oil': 'Gente Oil',
  'tribiol_gas': 'Tribiol Gas',
  'adico': 'Adico',
  'cuyaveno_petro': 'Cuyaveno Petro',
  'geopark': 'Geopark'
};

// Definición para certificateDurations (faltante en el código original)
const certificateDurations = {
  'license': {
    badgeId: 'licenseExpiryBadge',
    startField: 'id_license_issue_date',
    endField: 'id_license_expiry_date',
    name: 'Licencia'
  },
  'defensiveDriving': {
    badgeId: 'defensiveDrivingExpiryBadge',
    startField: 'id_defensive_driving_certificate_issue_date',
    endField: 'id_defensive_driving_certificate_expiry_date',
    name: 'Manejo Defensivo'
  },
  'mae': {
    badgeId: 'maeExpiryBadge',
    startField: 'id_mae_certificate_issue_date',
    endField: 'id_mae_certificate_expiry_date',
    name: 'MAE'
  },
  'medical': {
    badgeId: 'medicalExpiryBadge',
    startField: 'id_medical_certificate_issue_date',
    endField: 'id_medical_certificate_expiry_date',
    name: 'Médico'
  }
};

// Función para calcular la edad
function calculateAge(birthDateString) {
  if (!birthDateString) return null;
  const birthDate = new Date(birthDateString);
  const today = new Date();

  let age = today.getFullYear() - birthDate.getFullYear();
  const monthDiff = today.getMonth() - birthDate.getMonth();

  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
    age--;
  }
  return age < 0 ? 0 : age; // Evitar edad negativa si la fecha es futura
}

// Función para inicializar el calculador de fecha de nacimiento y edad
function initializeBirthDateCalculator() {
  const birthDateInput = document.getElementById('id_birth_date'); // Asumiendo que el ID es id_birth_date
  const ageDisplay = document.getElementById('ageDisplay');

  if (!birthDateInput || !ageDisplay) {
    // console.warn('Elementos para cálculo de edad no encontrados.');
    return;
  }

  function updateAgeDisplay() {
    const birthDateString = birthDateInput.value;
    if (birthDateString) {
      const age = calculateAge(birthDateString);
      if (age !== null) {
        ageDisplay.textContent = `${age} año${age === 1 ? '' : 's'}`;
        ageDisplay.style.display = 'inline-flex';
      } else {
        ageDisplay.style.display = 'none';
      }
    } else {
      ageDisplay.style.display = 'none';
    }
  }

  birthDateInput.addEventListener('change', updateAgeDisplay);
  // Llamada inicial para mostrar la edad si ya hay una fecha
  if (birthDateInput.value) {
    updateAgeDisplay();
  }
}

// Configuración para cálculo automático de fechas de vencimiento
const expiryConfig = {
  'license': {
    issueField: 'id_license_issue_date',
    expiryField: 'id_license_expiry_date',
    duration: 5, // años
    durationUnit: 'years'
  },
  'defensiveDriving': {
    issueField: 'id_defensive_driving_certificate_issue_date',
    expiryField: 'id_defensive_driving_certificate_expiry_date',
    duration: 2, // años
    durationUnit: 'years'
  },
  'mae': {
    issueField: 'id_mae_certificate_issue_date',
    expiryField: 'id_mae_certificate_expiry_date',
    duration: 2, // años
    durationUnit: 'years'
  },
  'medical': {
    issueField: 'id_medical_certificate_issue_date',
    expiryField: 'id_medical_certificate_expiry_date',
    duration: 1, // año
    durationUnit: 'years'
  }
};

// Función para calcular fecha de vencimiento basada en fecha de emisión
function calculateExpiryDate(issueDate, duration, unit = 'years') {
  if (!issueDate) return null;
  
  const date = new Date(issueDate);
  
  switch(unit) {
    case 'years':
      date.setFullYear(date.getFullYear() + duration);
      break;
    case 'months':
      date.setMonth(date.getMonth() + duration);
      break;
    case 'days':
      date.setDate(date.getDate() + duration);
      break;
  }
  
  // Formato YYYY-MM-DD para input type="date"
  return date.toISOString().split('T')[0];
}

// Configurar el cálculo automático de fechas de vencimiento
function setupExpiryDateCalculations() {
  Object.keys(expiryConfig).forEach(key => {
    const config = expiryConfig[key];
    const issueField = document.getElementById(config.issueField);
    const expiryField = document.getElementById(config.expiryField);
    
    if (!issueField || !expiryField) return;
    
    issueField.addEventListener('change', function() {
      const newExpiryDate = calculateExpiryDate(
        this.value, 
        config.duration, 
        config.durationUnit
      );
      
      if (newExpiryDate) {
        expiryField.value = newExpiryDate;
        
        // Destacar visualmente el campo actualizado
        expiryField.style.backgroundColor = '#f0f9ff';
        expiryField.style.borderColor = '#0ea5e9';
        
        // Actualizar el badge si existe
        if (certificateDurations[key]) {
          updateExpiryBadge(certificateDurations[key]);
        }
        
        // Quitar el destacado después de un momento
        setTimeout(() => {
          expiryField.style.backgroundColor = '';
          expiryField.style.borderColor = '';
        }, 2000);
      }
    });
    
    // Calcular fecha inicial si ya hay valor
    if (issueField.value) {
      const newExpiryDate = calculateExpiryDate(
        issueField.value, 
        config.duration, 
        config.durationUnit
      );
      
      if (newExpiryDate && !expiryField.value) {
        expiryField.value = newExpiryDate;
      }
    }
  });
}

// Función para formatear fecha
function formatDate(dateString) {
  if (!dateString) return '';
  const date = new Date(dateString);
  return date.toLocaleDateString('es-ES');
}

// Funciones para manejar modales de vacunación
function openVaccinationModal() {
  document.getElementById('vaccinationModal').classList.add('modal-open');
}

function closeVaccinationModal() {
  document.getElementById('vaccinationModal').classList.remove('modal-open');
  document.getElementById('vaccinationForm').reset();
}

// Funciones para manejar modales de pases técnicos
function openTechnicalPassModal() {
  document.getElementById('technicalPassModal').classList.add('modal-open');
}

function closeTechnicalPassModal() {
  document.getElementById('technicalPassModal').classList.remove('modal-open');
  document.getElementById('technicalPassForm').reset();
}

// Función para actualizar el modal de vacunación con esquemas automáticos
function updateVaccinationModal() {
  const vaccineTypeSelect = document.querySelector('#vaccinationForm select[name="vaccine_type"]');
  const doseNumberInput = document.querySelector('#vaccinationForm input[name="dose_number"]');
  const applicationDateInput = document.querySelector('#vaccinationForm input[name="application_date"]');
  const nextDoseDateInput = document.querySelector('#vaccinationForm input[name="next_dose_date"]');
  
  if (!vaccineTypeSelect || !applicationDateInput || !nextDoseDateInput) return;
  
  function calculateAndUpdateNextDose() {
    const vaccineType = vaccineTypeSelect.value;
    const doseNumber = doseNumberInput ? doseNumberInput.value || 1 : 1;
    const applicationDate = applicationDateInput.value;
    
    if (!vaccineType || !applicationDate) return;
    
    // Calcular próxima fecha basada en tipo de vacuna
    const nextDate = new Date(applicationDate);
    
    switch(vaccineType) {
      case 'HEPATITIS_A_B':
        if (doseNumber == 1) nextDate.setDate(nextDate.getDate() + 30);
        else if (doseNumber == 2) nextDate.setMonth(nextDate.getMonth() + 7);
        else if (doseNumber == 3) nextDate.setFullYear(nextDate.getFullYear() + 5);
        else return;
        break;
      case 'TETANUS':
        if (doseNumber == 1) nextDate.setDate(nextDate.getDate() + 30);
        else if (doseNumber == 2) nextDate.setMonth(nextDate.getMonth() + 7);
        else if (doseNumber == 3) nextDate.setFullYear(nextDate.getFullYear() + 1);
        else nextDate.setFullYear(nextDate.getFullYear() + 10);
        break;
      case 'TYPHOID':
        nextDate.setFullYear(nextDate.getFullYear() + 3);
        break;
      case 'INFLUENZA':
        nextDate.setFullYear(nextDate.getFullYear() + 1);
        break;
      case 'COVID':
        if (doseNumber <= 4) nextDate.setMonth(nextDate.getMonth() + 6);
        else return;
        break;
      case 'YELLOW_FEVER':
      case 'MEASLES':
        return; // Dosis única
      default:
        nextDate.setDate(nextDate.getDate() + 30);
    }
    
    if (nextDoseDateInput) {
      nextDoseDateInput.value = nextDate.toISOString().split('T')[0];
    }
  }
  
  // Agregar eventos para recalcular automáticamente
  if (vaccineTypeSelect) {
    vaccineTypeSelect.addEventListener('change', calculateAndUpdateNextDose);
  }
  
  if (doseNumberInput) {
    doseNumberInput.addEventListener('input', calculateAndUpdateNextDose);
  }
  
  if (applicationDateInput) {
    applicationDateInput.addEventListener('change', calculateAndUpdateNextDose);
  }
}

// Función para actualizar el badge de expiración de certificados
function updateExpiryBadge(config) {
  const startField = document.getElementById(config.startField);
  const endField = document.getElementById(config.endField);
  const badge = document.getElementById(config.badgeId);
  
  if (!badge || !endField) return;
  
  const endDate = endField.value ? new Date(endField.value) : null;
  
  if (!endDate) {
    badge.style.display = 'none';
    return;
  }
  
  const today = new Date();
  today.setHours(0, 0, 0, 0); // Normalizar la hora para comparación exacta
  endDate.setHours(0, 0, 0, 0);
  
  const timeDiff = endDate.getTime() - today.getTime();
  const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
  
  badge.style.display = 'inline-flex';
  
  if (daysDiff < 0) {
    // Vencido - mostrar días transcurridos en rojo
    const daysOverdue = Math.abs(daysDiff);
    badge.className = 'badge badge-error badge-soft';
    badge.textContent = `Vencido hace ${daysOverdue} día${daysOverdue === 1 ? '' : 's'}`;
    badge.style.backgroundColor = '#fecaca'; // rojo claro
    badge.style.color = '#991b1b'; // rojo oscuro
    badge.style.borderColor = '#f87171';
  } else if (daysDiff === 0) {
    // Vence hoy - rojo intenso
    badge.className = 'badge badge-error badge-soft';
    badge.textContent = 'Vence HOY';
    badge.style.backgroundColor = '#dc2626'; // rojo más intenso
    badge.style.color = '#ffffff'; // texto blanco
    badge.style.borderColor = '#dc2626';
    badge.style.fontWeight = 'bold';
  } else if (daysDiff <= 7) {
    // Vence en una semana - rojo urgente
    badge.className = 'badge badge-error badge-soft';
    badge.textContent = `Vence en ${daysDiff} día${daysDiff === 1 ? '' : 's'}`;
    badge.style.backgroundColor = '#fca5a5'; // rojo medio
    badge.style.color = '#7f1d1d'; // rojo muy oscuro
    badge.style.borderColor = '#ef4444';
    badge.style.fontWeight = 'bold';
  } else if (daysDiff <= 30) {
    // Vence en un mes - amarillo/naranja de advertencia
    badge.className = 'badge badge-warning badge-soft';
    badge.textContent = `Vence en ${daysDiff} día${daysDiff === 1 ? '' : 's'}`;
    badge.style.backgroundColor = '#fed7aa'; // naranja claro
    badge.style.color = '#9a3412'; // naranja oscuro
    badge.style.borderColor = '#fb923c';
  } else if (daysDiff <= 60) {
    // Próximo a vencer - amarillo suave
    badge.className = 'badge badge-warning badge-soft';
    badge.textContent = `Vence en ${daysDiff} días`;
    badge.style.backgroundColor = '#fef3c7'; // amarillo claro
    badge.style.color = '#92400e'; // amarillo oscuro
    badge.style.borderColor = '#fbbf24';
  } else {
    // Vigente - verde
    badge.className = 'badge badge-success badge-soft';
    if (daysDiff <= 365) {
      badge.textContent = `Vigente (${daysDiff} días)`;
    } else {
      const years = Math.floor(daysDiff / 365);
      const remainingDays = daysDiff % 365;
      if (remainingDays === 0) {
        badge.textContent = `Vigente (${years} año${years === 1 ? '' : 's'})`;
      } else {
        badge.textContent = `Vigente (${years}a ${remainingDays}d)`;
      }
    }
    badge.style.backgroundColor = '#dcfce7'; // verde claro
    badge.style.color = '#166534'; // verde oscuro
    badge.style.borderColor = '#4ade80';
  }
  
  // Añadir efecto de parpadeo para elementos críticos (vencidos o que vencen hoy)
  if (daysDiff <= 0) {
    badge.style.animation = 'pulse 2s infinite';
  } else {
    badge.style.animation = 'none';
  }
}

// Función mejorada para calcular estado del pase con días exactos
function getPassStatus(fechaCaducidad) {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  const expiry = new Date(fechaCaducidad);
  expiry.setHours(0, 0, 0, 0);
  
  const timeDiff = expiry.getTime() - today.getTime();
  const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
  
  if (daysDiff < 0) {
    const daysOverdue = Math.abs(daysDiff);
    return `<span class="badge badge-error badge-sm" style="background-color: #fecaca; color: #991b1b; border-color: #f87171; animation: pulse 2s infinite;">Vencido hace ${daysOverdue} día${daysOverdue === 1 ? '' : 's'}</span>`;
  } else if (daysDiff === 0) {
    return `<span class="badge badge-error badge-sm" style="background-color: #dc2626; color: #ffffff; border-color: #dc2626; font-weight: bold; animation: pulse 2s infinite;">Vence HOY</span>`;
  } else if (daysDiff <= 7) {
    return `<span class="badge badge-error badge-sm" style="background-color: #fca5a5; color: #7f1d1d; border-color: #ef4444; font-weight: bold;">Vence en ${daysDiff} día${daysDiff === 1 ? '' : 's'}</span>`;
  } else if (daysDiff <= 30) {
    return `<span class="badge badge-warning badge-sm" style="background-color: #fed7aa; color: #9a3412; border-color: #fb923c;">Vence en ${daysDiff} día${daysDiff === 1 ? '' : 's'}</span>`;
  } else if (daysDiff <= 60) {
    return `<span class="badge badge-warning badge-sm" style="background-color: #fef3c7; color: #92400e; border-color: #fbbf24;">Vence en ${daysDiff} días</span>`;
  } else {
    return `<span class="badge badge-success badge-sm" style="background-color: #dcfce7; color: #166534; border-color: #4ade80;">Vigente (${daysDiff} días)</span>`;
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Inicializar modal de vacunación con cálculos automáticos
  updateVaccinationModal();
  
  // Inicializar calculador de edad
  initializeBirthDateCalculator();
  
  // Inicializar badges de expiración
  Object.keys(certificateDurations).forEach(key => {
    const config = certificateDurations[key];
    
    // Configurar eventos para actualizar badges
    const startField = document.getElementById(config.startField);
    const endField = document.getElementById(config.endField);
    
    if (startField) startField.addEventListener('change', () => updateExpiryBadge(config));
    if (endField) endField.addEventListener('change', () => updateExpiryBadge(config));
    
    // Actualizar badge inicial
    updateExpiryBadge(config);
  });
  
  // Configurar cálculo automático de fechas de vencimiento
  setupExpiryDateCalculations();
  
  // Configurar manejadores de formularios
  const vaccinationForm = document.getElementById('vaccinationForm');
  if (vaccinationForm) {
    vaccinationForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const vaccinationData = {
        vaccine_type: formData.get('vaccine_type'),
        application_date: formData.get('application_date'),
        dose_number: formData.get('dose_number') || null,
        batch_number: formData.get('batch_number') || null,
        next_dose_date: formData.get('next_dose_date') || null,
        notes: formData.get('notes') || null
      };
      
      // Validar campos requeridos
      if (!vaccinationData.vaccine_type || !vaccinationData.application_date) {
        alert('Por favor complete los campos requeridos.');
        return;
      }
      
      addTempVaccination(vaccinationData);
      closeVaccinationModal();
    });
  }

  const technicalPassForm = document.getElementById('technicalPassForm');
  if (technicalPassForm) {
    technicalPassForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const passData = {
        bloque: formData.get('bloque'),
        fecha_caducidad: formData.get('fecha_caducidad')
      };
      
      // Validar campos requeridos
      if (!passData.bloque || !passData.fecha_caducidad) {
        alert('Por favor complete todos los campos.');
        return;
      }
      
      addTempPass(passData);
      closeTechnicalPassModal();
    });
  }
});

// Actualizar todos los badges de certificados cada minuto
setInterval(() => {
  Object.keys(certificateDurations).forEach(fieldId => {
    const config = certificateDurations[fieldId];
    updateExpiryBadge(config);
  });
}, 60000); // 60 segundos
</script>

<style>
  /* Forzar clases DaisyUI para todos los elementos del formulario Django */
  .form-control input,
  .form-control select,
  .form-control textarea {
    @apply input input-bordered w-full h-10 min-h-10 !important;
    height: 2.5rem !important;
    min-height: 2.5rem !important;
  }
  
  .form-control textarea {
    @apply textarea textarea-bordered min-h-20 !important;
    height: auto !important;
    min-height: 5rem !important;
  }
  
  /* Asegurar que todos los tipos de input tengan la misma altura */
  .form-control input[type="text"],
  .form-control input[type="email"],
  .form-control input[type="number"],
  .form-control input[type="tel"],
  .form-control input[type="date"],
  .form-control input[type="checkbox"] {
    @apply input input-bordered !important;
    height: 2.5rem !important;
    min-height: 2.5rem !important;
  }
  
  .form-control select {
    @apply select select-bordered !important;
    height: 2.5rem !important;
    min-height: 2.5rem !important;
  }
  
  /* Excepción para checkboxes */
  .form-control input[type="checkbox"] {
    @apply checkbox checkbox-primary !important;
    height: 1.25rem !important;
    width: 1.25rem !important;
    min-height: 1.25rem !important;
  }
  
  /* Efectos de hover y focus */
  .form-control input:focus,
  .form-control select:focus,
  .form-control textarea:focus {
    @apply ring-2 ring-blue-500 ring-opacity-50 border-blue-500 shadow-lg transition-all duration-200 !important;
  }
  
  .form-control:hover input:not(:focus),
  .form-control:hover select:not(:focus),
  .form-control:hover textarea:not(:focus) {
    @apply border-blue-300 shadow-md !important;
  }
  
  /* Espaciado consistente para labels */
  .label {
    @apply mb-2 !important;
    margin-bottom: 0.5rem !important;
  }
  
  .label-text {
    @apply leading-tight font-medium text-gray-700 !important;
  }
  
  /* Alineación vertical de elementos en grids */
  .grid > .form-control {
    @apply flex flex-col justify-start !important;
  }
  
  /* Espaciado consistente entre elementos */
  .space-y-4 > .form-control {
    margin-bottom: 1rem !important;
  }
  
  /* Headers de secciones */
  h3 {
    @apply border-b border-gray-200 pb-2 mb-4 !important;
  }
  
  /* Alineación específica para checkboxes en labels cursor-pointer */
  .label.cursor-pointer {
    @apply flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 !important;
    height: auto !important;
    min-height: 3rem !important;
  }
  
  .label.cursor-pointer .label-text {
    @apply text-sm font-medium text-gray-700 !important;
  }
  
  /* Asegurar altura mínima consistente para todos los controles de formulario */
  .form-control {
    @apply min-h-fit !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* Mejorar la apariencia de los elementos deshabilitados */
  .form-control input:disabled,
  .form-control select:disabled,
  .form-control textarea:disabled {
    @apply bg-gray-100 text-gray-500 cursor-not-allowed !important;
  }
  
  /* Normalizar apariencia de todos los inputs para que sean consistentes */
  .form-control input,
  .form-control select {
    border-radius: 0.5rem !important;
    border-width: 1px !important;
    border-color: #d1d5db !important;
    padding: 0.5rem 0.75rem !important;
    font-size: 0.875rem !important;
    line-height: 1.25rem !important;
  }
  
  /* Asegurar que los elementos de fecha tengan la misma apariencia */
  .form-control input[type="date"] {
    @apply input input-bordered !important;
    appearance: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: textfield !important;
  }
  
  /* Normalizar select */
  .form-control select {
    @apply select select-bordered !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
    background-position: right 0.5rem center !important;
    background-repeat: no-repeat !important;
    background-size: 1.5em 1.5em !important;
    padding-right: 2.5rem !important;
  }
  
  /* Badge con estilo suave personalizado */
  .badge-soft {
    @apply text-xs font-medium px-2.5 py-0.5 rounded-full !important;
    border: 1px solid transparent !important;
  }
  
  .badge-soft.badge-info {
    @apply bg-blue-50 text-blue-700 border-blue-200 !important;
  }
  
  .badge-soft.badge-warning {
    @apply bg-orange-50 text-orange-700 border-orange-200 !important;
  }
  
  .badge-soft.badge-secondary {
    @apply bg-purple-50 text-purple-700 border-purple-200 !important;
  }
  
  .badge-soft.badge-success {
    @apply bg-green-50 text-green-700 border-green-200 !important;
  }
  
  .badge-soft.badge-error {
    @apply bg-red-50 text-red-700 border-red-200 !important;
  }
  
  /* Efecto hover para badges */
  .badge-soft:hover {
    @apply shadow-sm transform scale-105 transition-all duration-200 !important;
  }
  
  .badge-soft.badge-info:hover {
    @apply bg-blue-100 border-blue-300 !important;
  }
  
  .badge-soft.badge-warning:hover {
    @apply bg-orange-100 border-orange-300 !important;
  }
  
  .badge-soft.badge-secondary:hover {
    @apply bg-purple-100 border-purple-300 !important;
  }
  
  .badge-soft.badge-success:hover {
    @apply bg-green-100 border-green-300 !important;
  }
  
  .badge-soft.badge-error:hover {
    @apply bg-red-100 border-red-300 !important;
  }
  
  /* Animación de pulso para elementos críticos */
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.8;
      transform: scale(1.05);
    }
  }
  
  /* Mejora para badges críticos */
  .badge.critical {
    animation: pulse 2s infinite;
    box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
  }
  
  /* Colores específicos para estados de vencimiento */
  .badge-expired {
    background-color: #fecaca !important;
    color: #991b1b !important;
    border-color: #f87171 !important;
  }
  
  .badge-expires-today {
    background-color: #dc2626 !important;
    color: #ffffff !important;
    border-color: #dc2626 !important;
    font-weight: bold !important;
  }
  
  .badge-expires-soon {
    background-color: #fca5a5 !important;
    color: #7f1d1d !important;
    border-color: #ef4444 !important;
    font-weight: bold !important;
  }
  
  .badge-expires-warning {
    background-color: #fed7aa !important;
    color: #9a3412 !important;
    border-color: #fb923c !important;
  }
  
  .badge-expires-caution {
    background-color: #fef3c7 !important;
    color: #92400e !important;
    border-color: #fbbf24 !important;
  }
  
  .badge-valid {
    background-color: #dcfce7 !important;
    color: #166534 !important;
    border-color: #4ade80 !important;
  }
</style>

{% endblock %}
