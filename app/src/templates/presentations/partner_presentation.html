{% extends 'base/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-md border border-t-[15px] border-t-blue-500">
  <div class="flex justify-between items-center border-b-blue-500 bo        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <i class="las la-edit text-lg text-gray-500"></i>
    <h1 class="text-2xl font-semibold text-blue-500">Ficha de Socio de Negocio</h1>
    <div class="text-gray-500">
      <span class="badge {% if partner.is_active %}badge-success{% else %}badge-error{% endif %}">
        {% if partner.is_active %}Activo{% else %}Inactivo{% endif %}
      </span>
    </div>
  </div>

  <!-- Tabs para organizar la información -->
  <div class="tabs tabs-box w-full mb-4">
    <input type="radio" name="detail_tabs" class="tab" aria-label="Información General" checked />
    <div class="tab-content bg-base-100 border-base-300 p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Datos Principales -->
        <div class="space-y-4 border-l-blue-300 border-l-[1px] pl-5">
          <h3 class="text-lg font-medium text-blue-600 mb-4">Datos Principales</h3>
          <div>
            <p class="text-sm text-gray-500">RUC</p>
            <p class="font-semibold text-gray-900">{{ partner.business_tax_id }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Nombre</p>
            <p class="font-semibold text-gray-900">{{ partner.name }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Correo Electrónico</p>
            <p class="font-semibold text-gray-900">{{ partner.email|default:"No registrado" }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Teléfono</p>
            <p class="font-semibold text-gray-900">{{ partner.phone|default:"No registrado" }}</p>
          </div>
        </div>

        <!-- Datos de Contacto y Ubicación -->
        <div class="space-y-4 border-l-blue-300 border-l-[1px] pl-5">
          <h3 class="text-lg font-medium text-blue-600 mb-4">Contacto y Ubicación</h3>
          
          <div>
            <p class="text-sm text-gray-500">Dirección</p>
            <p class="font-semibold text-gray-900">{{ partner.address }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Nombre de Contacto</p>
            <p class="font-semibold text-gray-900">{% if partner.name_contact %}{{ partner.name_contact }}{% else %}No Registrado{% endif %}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Estado</p>
            <span class="badge {% if partner.is_active %}badge-success{% else %}badge-error{% endif %}">
              {% if partner.is_active %}Activo{% else %}Inactivo{% endif %}
            </span>
          </div>
        </div>
      </div>

      <!-- Notas -->
      <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <h3 class="text-lg font-medium text-blue-600 mb-4">Notas y Observaciones</h3>
        <p class="font-semibold text-gray-900">{% if partner.notes %}{{ partner.notes }}{% else %}Sin Observaciones{% endif %}</p>
      </div>
    </div>

    <input type="radio" name="detail_tabs" class="tab" aria-label="Equipos Asignados" />
    <div class="tab-content bg-base-100 border-base-300 p-6">
      <!-- Equipos Asignados del Socio -->
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="border-b border-gray-200 p-4">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Equipos Asignados</h3>
              <p class="text-sm text-gray-500 mt-1">Listado de todos los equipos asignados a proyectos del socio</p>
            </div>
            <a href="{% url 'project_create' %}?partner={{ partner.pk }}" 
               class="btn btn-primary btn-sm">
              <i class="las la-plus text-xl"></i>
              Nuevo Proyecto
            </a>
          </div>
        </div>
        <div class="p-4">
          {% if partner_complete_info.equipment_assignments %}
            <!-- Estadísticas rápidas de equipos -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div class="p-3 bg-blue-50 rounded-lg text-center">
                <div class="text-2xl font-bold text-blue-600">{{ partner_complete_info.operational_statistics.total_equipment_assigned }}</div>
                <div class="text-xs text-blue-500">Total Equipos</div>
              </div>
              <div class="p-3 bg-green-50 rounded-lg text-center">
                <div class="text-2xl font-bold text-green-600">{{ partner_complete_info.operational_statistics.active_equipment_count }}</div>
                <div class="text-xs text-green-500">Activos</div>
              </div>
              <div class="p-3 bg-yellow-50 rounded-lg text-center">
                <div class="text-2xl font-bold text-yellow-600">{{ partner_complete_info.operational_statistics.retired_equipment_count }}</div>
                <div class="text-xs text-yellow-500">Retirados</div>
              </div>
              <div class="p-3 bg-purple-50 rounded-lg text-center">
                <div class="text-2xl font-bold text-purple-600">${{ partner_complete_info.financial_summary.total_equipment_costs|floatformat:2 }}</div>
                <div class="text-xs text-purple-500">Costo Total</div>
              </div>
            </div>
            
            <!-- Tabla de equipos -->
            <div class="overflow-x-auto">
              <table class="table table-zebra w-full text-sm">
                <thead>
                  <tr class="bg-gray-100">
                    <th class="text-left">Código</th>
                    <th class="text-left">Nombre del Equipo</th>
                    <th class="text-left">Tipo</th>
                    <th class="text-left">Proyecto</th>
                    <th class="text-left">Fechas Operación</th>
                    <th class="text-right">Costo Renta</th>
                    <th class="text-right">Costo Mantto.</th>
                    <th class="text-center">Estado</th>
                    <th class="text-center">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for assignment in partner_complete_info.equipment_assignments %}
                  <tr class="hover:bg-gray-50">
                    <td class="font-mono text-xs">
                      <span class="badge badge-outline badge-sm">{{ assignment.equipment_code|default:"S/C" }}</span>
                    </td>
                    <td>
                      <div class="flex flex-col">
                        <span class="font-medium text-gray-900">{{ assignment.equipment_name }}</span>
                        <span class="text-xs text-gray-500">{{ assignment.equipment_brand }} {{ assignment.equipment_model }}</span>
                      </div>
                    </td>
                    <td>
                      <span class="badge badge-info badge-sm">{{ assignment.equipment_type|default:"N/A" }}</span>
                    </td>
                    <td>
                      <div class="flex flex-col">
                        <span class="font-medium text-sm">Proyecto #{{ assignment.project_id }}</span>
                        <span class="text-xs text-gray-500">{{ assignment.project_location|default:"Sin ubicación" }}</span>
                      </div>
                    </td>
                    <td>
                      <div class="flex flex-col text-xs">
                        <span><strong>Inicio:</strong> {{ assignment.operation_start_date|date:"d/m/Y" }}</span>
                        <span><strong>Fin:</strong> {{ assignment.operation_end_date|date:"d/m/Y" }}</span>
                        {% if assignment.operation_days %}
                        <span class="text-gray-500">({{ assignment.operation_days }} días)</span>
                        {% endif %}
                      </div>
                    </td>
                    <td class="text-right font-mono text-sm">
                      ${{ assignment.rent_cost|floatformat:2 }}
                    </td>
                    <td class="text-right font-mono text-sm">
                      ${{ assignment.maintenance_cost|floatformat:2 }}
                    </td>
                    <td class="text-center">
                      {% if assignment.is_retired %}
                        <span class="badge badge-warning badge-sm">Retirado</span>
                        {% if assignment.retirement_date %}
                        <div class="text-xs text-gray-500 mt-1">{{ assignment.retirement_date|date:"d/m/Y" }}</div>
                        {% endif %}
                      {% else %}
                        <span class="badge badge-success badge-sm">Activo</span>
                      {% endif %}
                    </td>
                    <td class="text-center">
                      <div class="flex gap-1 justify-center">
                        <a href="{% url 'resource_detail' assignment.equipment_id %}" 
                           class="btn btn-ghost btn-xs text-blue-600" 
                           title="Ver equipo">
                          <i class="las la-eye"></i>
                        </a>
                        <a href="{% url 'project_detail' assignment.project_id %}" 
                           class="btn btn-ghost btn-xs text-green-600" 
                           title="Ver proyecto">
                          <i class="las la-project-diagram"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            
            <!-- Resumen adicional -->
            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="text-center">
                  <span class="text-gray-600">Valor Total Asignaciones:</span>
                  <span class="font-bold text-green-600 ml-2">${{ partner_complete_info.financial_summary.total_equipment_costs|floatformat:2 }}</span>
                </div>
                <div class="text-center">
                  <span class="text-gray-600">Mantenimiento cada:</span>
                  <span class="font-bold text-blue-600 ml-2">
                    {% if partner_complete_info.equipment_assignments.0.maintenance_interval_days %}
                      {{ partner_complete_info.equipment_assignments.0.maintenance_interval_days }} días (promedio)
                    {% else %}
                      Variable
                    {% endif %}
                  </span>
                </div>
                <div class="text-center">
                  <span class="text-gray-600">Tasa Utilización:</span>
                  <span class="font-bold text-purple-600 ml-2">{{ partner_complete_info.operational_statistics.equipment_utilization_rate|floatformat:1 }}%</span>
                </div>
              </div>
            </div>
          {% else %}
            <div class="text-center py-12">
              <i class="las la-tools text-6xl text-gray-300 mb-4"></i>
              <h4 class="text-lg font-medium text-gray-500 mb-2">No hay equipos asignados</h4>
              <p class="text-gray-400 text-sm mb-4">Este socio aún no tiene equipos asignados a ningún proyecto</p>
              <a href="{% url 'project_create' %}?partner={{ partner.pk }}" class="btn btn-primary btn-sm">
                <i class="las la-plus text-xl"></i>
                Crear Proyecto y Asignar Equipos
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Nueva pestaña de Información Completa -->
    <input type="radio" name="detail_tabs" class="tab" aria-label="Información Completa" />
    <div class="tab-content bg-base-100 border-base-300 p-6">
      <h3 class="text-md font-semibold text-blue-500 mb-4">Información Completa del Partner</h3>
      
      <!-- Resumen Ejecutivo -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="p-4 bg-blue-50 rounded-lg shadow-sm border border-blue-200">
          <div class="text-2xl font-bold text-blue-600">{{ partner_complete_info.projects_summary.total_projects }}</div>
          <div class="text-xs text-blue-500">Total Proyectos</div>
        </div>
        <div class="p-4 bg-green-50 rounded-lg shadow-sm border border-green-200">
          <div class="text-2xl font-bold text-green-600">{{ partner_complete_info.projects_summary.active_projects }}</div>
          <div class="text-xs text-green-500">Proyectos Activos</div>
        </div>
        <div class="p-4 bg-yellow-50 rounded-lg shadow-sm border border-yellow-200">
          <div class="text-2xl font-bold text-yellow-600">${{ partner_complete_info.financial_summary.total_business_value|floatformat:2 }}</div>
          <div class="text-xs text-yellow-500">Valor Total Negocio</div>
        </div>
        <div class="p-4 bg-purple-50 rounded-lg shadow-sm border border-purple-200">
          <div class="text-2xl font-bold text-purple-600">{{ partner_complete_info.operational_statistics.active_equipment_count }}</div>
          <div class="text-xs text-purple-500">Equipos Activos</div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Estadísticas Financieras -->
        <div class="p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <i class="las la-dollar-sign text-lg text-green-500"></i>
            Resumen Financiero
          </h4>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Costos de Renta:</span>
              <span class="font-semibold">${{ partner_complete_info.financial_summary.total_rent_costs|floatformat:2 }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Costos Mantenimiento:</span>
              <span class="font-semibold">${{ partner_complete_info.financial_summary.total_maintenance_costs|floatformat:2 }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Total Facturado:</span>
              <span class="font-semibold text-green-600">${{ partner_complete_info.financial_summary.total_invoiced_amount|floatformat:2 }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Total Pendiente:</span>
              <span class="font-semibold text-yellow-600">${{ partner_complete_info.financial_summary.total_pending_amount|floatformat:2 }}</span>
            </div>
            <div class="flex justify-between pt-2 border-t">
              <span class="text-gray-600">Valor Promedio/Proyecto:</span>
              <span class="font-semibold text-blue-600">${{ partner_complete_info.financial_summary.average_project_value|floatformat:2 }}</span>
            </div>
          </div>
        </div>

        <!-- Estadísticas Operativas -->
        <div class="p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <i class="las la-cogs text-lg text-blue-500"></i>
            Estadísticas Operativas
          </h4>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Equipos Asignados:</span>
              <span class="font-semibold">{{ partner_complete_info.operational_statistics.total_equipment_assigned }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Equipos Retirados:</span>
              <span class="font-semibold">{{ partner_complete_info.operational_statistics.retired_equipment_count }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Duración Promedio:</span>
              <span class="font-semibold">{{ partner_complete_info.operational_statistics.average_project_duration|floatformat:1 }} días</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Tasa Utilización:</span>
              <span class="font-semibold">{{ partner_complete_info.operational_statistics.equipment_utilization_rate|floatformat:1 }}%</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Tipo Equipo Más Usado:</span>
              <span class="font-semibold text-xs">{{ partner_complete_info.operational_statistics.most_used_equipment_type|default:"N/A" }}</span>
            </div>
          </div>
        </div>

        <!-- Planillas y Facturación -->
        <div class="p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <i class="las la-file-invoice text-lg text-purple-500"></i>
            Planillas y Facturación
          </h4>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Planillas Facturadas:</span>
              <span class="font-semibold text-green-600">{{ partner_complete_info.financial_summary.invoiced_sheets_count }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Planillas Pendientes:</span>
              <span class="font-semibold text-yellow-600">{{ partner_complete_info.financial_summary.pending_sheets_count }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Planillas Canceladas:</span>
              <span class="font-semibold text-red-600">{{ partner_complete_info.financial_summary.cancelled_sheets_count }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Proyectos Cerrados:</span>
              <span class="font-semibold">{{ partner_complete_info.projects_summary.closed_projects }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Alertas de Mantenimiento -->
      {% if partner_complete_info.maintenance_alerts %}
      <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
        <h4 class="font-medium text-yellow-700 mb-3 flex items-center gap-2">
          <i class="las la-exclamation-triangle text-lg text-yellow-600"></i>
          Alertas de Mantenimiento
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          {% for alert in partner_complete_info.maintenance_alerts|slice:":4" %}
          <div class="p-3 bg-white rounded border {% if alert.level == 'high' %}border-red-300{% elif alert.level == 'medium' %}border-yellow-300{% else %}border-blue-300{% endif %}">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium {% if alert.level == 'high' %}text-red-600{% elif alert.level == 'medium' %}text-yellow-600{% else %}text-blue-600{% endif %}">
                  {{ alert.message }}
                </p>
                <p class="text-xs text-gray-500">{{ alert.equipment_name }} - {{ alert.project_location }}</p>
              </div>
              <span class="px-2 py-1 rounded text-xs {% if alert.level == 'high' %}bg-red-100 text-red-600{% elif alert.level == 'medium' %}bg-yellow-100 text-yellow-600{% else %}bg-blue-100 text-blue-600{% endif %}">
                {{ alert.days_remaining }} días
              </span>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Actividad Reciente -->
      {% if partner_complete_info.recent_activity %}
      <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
          <i class="las la-history text-lg text-gray-500"></i>
          Actividad Reciente (Últimos 30 días)
        </h4>
        <div class="space-y-2 max-h-48 overflow-y-auto">
          {% for activity in partner_complete_info.recent_activity|slice:":10" %}
          <div class="flex items-center justify-between p-2 bg-white rounded border border-gray-100">
            <div class="flex items-center gap-2">
              {% if activity.type == 'project_created' %}
                <i class="las la-plus-circle text-green-500"></i>
              {% elif activity.type == 'equipment_assigned' %}
                <i class="las la-tools text-blue-500"></i>
              {% elif activity.type == 'sheet_created' %}
                <i class="las la-file-invoice text-purple-500"></i>
              {% endif %}
              <span class="text-sm text-gray-700">{{ activity.description }}</span>
            </div>
            <span class="text-xs text-gray-500">{{ activity.date|date:"d/m/Y" }}</span>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Equipos por Tipo -->
      {% if partner_complete_info.operational_statistics.equipment_by_type %}
      <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
          <i class="las la-chart-bar text-lg text-gray-500"></i>
          Distribución de Equipos por Tipo
        </h4>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          {% for equipment_type in partner_complete_info.operational_statistics.equipment_by_type|slice:":8" %}
          <div class="p-3 bg-white rounded border border-gray-200 text-center">
            <div class="text-lg font-bold text-blue-600">{{ equipment_type.count }}</div>
            <div class="text-xs text-gray-500">{{ equipment_type.resource_item__type_equipment|default:"Sin Tipo" }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Información de Rangos de Fechas -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
          <h4 class="font-medium text-blue-700 mb-3 flex items-center gap-2">
            <i class="las la-calendar text-lg text-blue-600"></i>
            Historial de Proyectos
          </h4>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-blue-600">Primer Proyecto:</span>
              <span class="font-semibold">{{ partner_complete_info.projects_summary.earliest_project_date|date:"d/m/Y"|default:"N/A" }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-blue-600">Último Proyecto:</span>
              <span class="font-semibold">{{ partner_complete_info.projects_summary.latest_project_date|date:"d/m/Y"|default:"N/A" }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-blue-600">Total Días Proyectos:</span>
              <span class="font-semibold">{{ partner_complete_info.projects_summary.projects_duration_days }} días</span>
            </div>
          </div>
        </div>

        <div class="p-4 bg-green-50 rounded-lg border border-green-200">
          <h4 class="font-medium text-green-700 mb-3 flex items-center gap-2">
            <i class="las la-user text-lg text-green-600"></i>
            Información del Cliente
          </h4>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-green-600">Cliente desde:</span>
              <span class="font-semibold">{{ partner_complete_info.partner_basic_info.created_at|date:"d/m/Y" }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-green-600">Última actualización:</span>
              <span class="font-semibold">{{ partner_complete_info.partner_basic_info.updated_at|date:"d/m/Y" }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-green-600">Estado:</span>
              <span class="font-semibold {% if partner_complete_info.partner_basic_info.is_active %}text-green-600{% else %}text-red-600{% endif %}">
                {% if partner_complete_info.partner_basic_info.is_active %}Activo{% else %}Inactivo{% endif %}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Nueva pestaña de Metadatos -->
    <input type="radio" name="detail_tabs" class="tab" aria-label="Metadatos" />
    <div class="tab-content bg-base-100 border-base-300 p-6">
      <h3 class="text-md font-semibold text-blue-500 mb-4">Información de Auditoría</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Información de Registro -->
        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <i class="las la-file-alt text-xl"></i>
            Registro Inicial
          </h4>
          <div class="space-y-2 text-sm">
            <div>
              <span class="text-gray-500">Fecha de Registro:</span>
              <span class="font-medium">{{ partner.created_at|date:"d-m-Y H:i"|default:"No registrada" }}</span>
            </div>
            <div>
              <span class="text-gray-500">Usuario Registrador:</span>
              <span class="font-medium">
                {% if partner.get_create_user %}
                  {{ partner.get_create_user }}
                {% else %}
                  Sistema
                {% endif %}
              </span>
            </div>
            <div>
              <span class="text-gray-500">ID del Registro:</span>
              <span class="font-medium font-mono">#{{ partner.id }}</span>
            </div>
          </div>
        </div>

        <!-- Información de Modificación -->
        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Última Modificación
          </h4>
          <div class="space-y-2 text-sm">
            <div>
              <span class="text-gray-500">Fecha de Modificación:</span>
              <span class="font-medium">{{ partner.updated_at|date:"d-m-Y H:i"|default:"No modificado" }}</span>
            </div>
            <div>
              <span class="text-gray-500">Usuario Modificador:</span>
              <span class="font-medium">
                {% if partner.get_update_user %}
                  {{ partner.get_update_user }}
                {% else %}
                  No modificado
                {% endif %}
              </span>
            </div>
            <div>
              <span class="text-gray-500">Versión:</span>
              <span class="font-medium">1.0</span>
            </div>
          </div>
        </div>

        <!-- Estadísticas del Socio -->
        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
          <h4 class="font-medium text-blue-700 mb-3 flex items-center gap-2">
            <i class="las la-chart-bar text-xl"></i>
            Estadísticas
          </h4>
          <div class="space-y-2 text-sm">
            <div>
              <span class="text-gray-500">Proyectos Totales:</span>
              <span class="font-medium text-blue-600">{{ projects_stats.total|default:0 }}</span>
            </div>
            <div>
              <span class="text-gray-500">Proyectos Activos:</span>
              <span class="font-medium text-green-600">{{ projects_stats.active|default:0 }}</span>
            </div>
            <div>
              <span class="text-gray-500">Relación Comercial:</span>
              <span class="font-medium text-purple-600">Cliente</span>
            </div>
          </div>
        </div>

        <!-- Información del Sistema -->
        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
          <h4 class="font-medium text-gray-700 mb-3 flex items-center gap-2">
            <i class="las la-desktop text-xl"></i>
            Sistema
          </h4>
          <div class="space-y-2 text-sm">
            <div>
              <span class="text-gray-500">Estado del Registro:</span>
              <span class="badge badge-sm {% if partner.is_active %}badge-success{% else %}badge-error{% endif %}">
                {% if partner.is_active %}Activo{% else %}Inactivo{% endif %}
              </span>
            </div>
            <div>
              <span class="text-gray-500">Tipo de Registro:</span>
              <span class="font-medium">Socio de Negocio</span>
            </div>
            <div>
              <span class="text-gray-500">Observaciones:</span>
              <span class="font-medium">
                {% if partner.notes %}
                  {{ partner.notes|truncatewords:10 }}
                {% else %}
                  Sin observaciones
                {% endif %}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Botones de acción -->
  <div class="flex flex-wrap justify-center gap-2 mt-6 border-t pt-4">
    <a href="{% url 'partner_create' %}" class="btn btn-sm btn-outline btn-dark">
      <i class="las la-plus text-xl"></i>
      Agregar Nuevo
    </a>
    <a href="{% url 'partner_update' partner.id %}" class="btn btn-sm btn-outline btn-dark">
      <i class="las la-edit text-xl"></i>
      Editar
    </a>
    <a href="{% url 'partner_detail' partner.id %}?action=delete" class="btn btn-sm btn-outline btn-error">
      <i class="las la-trash text-xl"></i>
      Eliminar
    </a>
    <a href="{% url 'partner_list' %}" class="btn btn-sm btn-outline border-black">
      <i class="las la-arrow-left text-xl"></i>
      Volver al Listado
    </a>
    <a href="{% url 'partner_detail' partner.id %}?action=delete" class="btn btn-sm btn-outline btn-error">
      <i class="las la-trash text-lg"></i>
      Confirmar Eliminación
    </a>
    <a href="{% url 'partner_detail' partner.id %}" class="btn btn-outline ml-2 border-black">
      <i class="las la-times text-lg"></i>
      Cancelar
    </a>
  </div>

  {% if action == 'delete' %}
  <div class="flex justify-center mt-6 mb-6">
    <div class="alert alert-warning max-w-md">
      <i class="las la-exclamation-triangle text-warning"></i>
      <span>¿Estás seguro de que deseas eliminar este socio? Esta acción no se puede deshacer.</span>
    </div>
  </div>
  <div class="flex justify-center mb-6">
    <a href="{% url 'partner_delete' request.resolver_match.kwargs.pk %}" class="btn btn-error">
      <i class="las la-trash text-lg"></i>
      </svg>
      Confirmar Eliminación
    </a>
    <a href="{% url 'partner_detail' partner.id %}" class="btn btn-outline ml-2 border-black">
      Cancelar
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block script %}
<script>
    function openPopup(url) {
        window.open(
            url,
            '_blank',
            'width=800,height=600,scrollbars=yes,resizable=yes'
        );
    }
</script>
{% endblock %}

