{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="w-full max-w-none px-2 py-4">
    <!-- Botones de acción superiores (no se imprimen) -->
    <div class="flex gap-2 mb-6 print:hidden">
        <a href="{% url 'custody_chain_list' %}" class="btn btn-outline gap-2">
            <i class="fas fa-arrow-left"></i>
            Volver al Listado
        </a>
        <button onclick="window.print()" class="btn btn-primary gap-2">
            <i class="fas fa-print"></i>
            Imprimir
        </button>
        <button onclick="exportToPDF()" class="btn btn-success gap-2">
            <i class="fas fa-file-pdf"></i>
            Exportar PDF
        </button>
    </div>

    <!-- Documento de Cadena de Custodia -->
    <div class="card bg-base-100 shadow-xl print:shadow-none border-2 border-gray-300 w-full" id="custody-chain-document">
        <div class="card-body p-0">
            <!-- Encabezado del Documento - Estilo formulario físico -->
            <div class="border-b-2 border-gray-300">
                <!-- Título y Logo -->
                <div class="grid grid-cols-12 items-start p-3 border-b border-gray-300">
                    <div class="col-span-10">
                        <h1 class="text-sm font-bold leading-tight">
                            MANTENIMIENTO DE EQUIPOS SANITARIOS, TRANSPORTE Y CADENA DE CUSTODIA DE AGUAS RESIDUALES
                        </h1>
                    </div>
                    <div class="col-span-2 flex justify-end">
                        <img src="{% static 'img/logo.png' %}" 
                             alt="PEISOL Ingeniería" 
                             class="h-12"
                             onerror="this.style.display='none'">
                    </div>
                </div>
                
                <!-- Fila de información básica -->
                <div class="grid grid-cols-12 border-b border-gray-300 text-xs">
                    <div class="col-span-3 border-r border-gray-300 p-1">
                        <span class="font-bold">FECHA:</span>
                        <span class="ml-2">{{ custody_chain.activity_date|date:"d/m/Y" }}</span>
                    </div>
                    <div class="col-span-3 border-r border-gray-300 p-1">
                        <span class="font-bold">PLACAS:</span>
                        <span class="ml-2">{{ custody_chain.vehicle.no_plate|default:"N/A" }}</span>
                    </div>
                    <div class="col-span-4 border-r border-gray-300 p-1">
                        <span class="font-bold">LOGÍSTICA:</span>
                        <label class="ml-2"><input type="checkbox" class="checkbox checkbox-xs mr-1" disabled> SI</label>
                        <label class="ml-2"><input type="checkbox" class="checkbox checkbox-xs mr-1" disabled> NO</label>
                    </div>
                    <div class="col-span-2 p-1 text-right">
                        <span class="font-bold text-red-600 text-base">No. {{ custody_chain.consecutive }}</span>
                    </div>
                </div>
                
                <!-- Segunda fila -->
                <div class="grid grid-cols-12 border-b border-gray-300 text-xs">
                    <div class="col-span-4 border-r border-gray-300 p-1">
                        <span class="font-bold">CLIENTE:</span>
                        <span class="ml-2">{{ partner.name }}</span>
                    </div>
                    <div class="col-span-8 p-1">
                        <span class="font-bold">PROYECTO:</span>
                        <span class="ml-2">{{ project.location|default:"" }}</span>
                    </div>
                </div>
                
                <!-- Tercera fila - Horarios -->
                <div class="grid grid-cols-12 text-xs">
                    <div class="col-span-4 border-r border-gray-300 p-1">
                        <span class="font-bold">HORA DE LLEGADA:</span>
                        <span class="ml-2">{{ custody_chain.start_time|time:"H:i"|default:"" }}</span>
                    </div>
                    <div class="col-span-4 border-r border-gray-300 p-1">
                        <span class="font-bold">HORA DE SALIDA:</span>
                        <span class="ml-2">{{ custody_chain.end_time|time:"H:i"|default:"" }}</span>
                    </div>
                    <div class="col-span-4 p-1">
                        <span class="font-bold">TOTAL DE HORAS:</span>
                        <span class="ml-2">{{ custody_chain.time_duration|default:"0.00" }}</span>
                    </div>
                </div>
            </div>

            <!-- Tabla principal estilo formulario físico -->
            <div class="overflow-x-auto">
                <table class="table table-bordered table-sm text-xs">
                    <thead>
                        <tr class="bg-base-200 text-center">
                            <th class="align-middle" rowspan="2">EQUIPO</th>
                            <th class="align-middle" rowspan="2">CÓDIGO</th>
                            <th class="align-middle" colspan="3">TRABAJO REALIZADO</th>
                            <th class="align-middle" colspan="4">INSUMOS Y QUÍMICOS</th>
                            <th class="align-middle" colspan="8">GALONES DE AGUA RESIDUAL SUCCIONADA</th>
                            <th class="align-middle" rowspan="2">DESCRIPCIÓN</th>
                            <th class="align-middle" rowspan="2">ABREVIATURA</th>
                            <th class="align-middle" rowspan="2">MATERIAL TRANSPORTADO</th>
                        </tr>
                        <tr class="bg-base-200 text-center">
                            <th>SUC</th>
                            <th>LIMP</th>
                            <th>QUIM</th>
                            <th>PH</th>
                            <th>TZ</th>
                            <th>FUN</th>
                            <th>ABT</th>
                            <th>10</th>
                            <th>20</th>
                            <th>30</th>
                            <th>40</th>
                            <th>50</th>
                            <th>60</th>
                            <th>70</th>
                            <th>&gt;71</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>BAÑOS</td><td>BT</td><td>AGUAS NEGRAS</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>LAVAMANOS</td><td>LV</td><td>AGUAS GRISES</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>URINARIO</td><td>UR</td><td>AGUA LIMPIA</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>BIODIGESTOR</td><td>BG</td><td>LODOS ACTIVADOS</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>TRAMPA DE GRASA</td><td>TG</td><td>AGUA RESIDUAL TRATADA</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>ESTACIÓN DE BOMBEO</td><td>EB</td><td>GRASA ORGÁNICA</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>PLANTA DE AGUA RESIDUAL</td><td>PTAR</td><td>PESO Y/O VOLUMEN</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>PLANTA DE AGUA POTABLE</td><td>PTAP</td><td>GALÓN</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>OTROS</td><td>OT</td><td>M3</td>
                        </tr>
                        <tr>
                            <td></td><td></td>
                            <td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td>
                            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                            <td>--</td><td>--</td><td>BARRIL</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Totales (igual que el formulario) -->
            <div class="grid grid-cols-3 gap-3 mt-4 text-xs">
                <div class="form-control">
                    <label class="label"><span class="label-text font-semibold">Total de Galones</span></label>
                    <div class="input input-bordered input-xs w-full bg-base-100">
                        {{ custody_chain.total_gallons }}
                    </div>
                </div>
                <div class="form-control">
                    <label class="label"><span class="label-text font-semibold">Total de Metros Cúbicos</span></label>
                    <div class="input input-bordered input-xs w-full bg-base-100">
                        {{ custody_chain.total_cubic_meters }}
                    </div>
                </div>
                <div class="form-control">
                    <label class="label"><span class="label-text font-semibold">Total de Barriles</span></label>
                    <div class="input input-bordered input-xs w-full bg-base-100">
                        {{ custody_chain.total_barrels }}
                    </div>
                </div>
            </div>

            <!-- Sección inferior: Origen, Transportista, Disposición Final -->
            <div class="grid grid-cols-12 text-xs mt-4 border border-gray-300">
                <div class="col-span-4 border-r border-gray-300">
                    <div class="text-center font-bold bg-base-200 border-b border-gray-300 py-1">LUGAR DE ORIGEN</div>
                    <div class="p-1 border-b border-gray-300">NOMBRE: {{ custody_chain.contact_name|default:"" }}</div>
                    <div class="p-1 border-b border-gray-300">C.I.: {{ custody_chain.dni_contact|default:"" }}</div>
                    <div class="p-1 border-b border-gray-300">CARGO: {{ custody_chain.contact_position|default:"" }}</div>
                    <div class="p-1 border-b border-gray-300">FECHA: {{ custody_chain.date_contact|date:"d/m/Y"|default:"" }}</div>
                    <div class="p-1">FIRMA:</div>
                </div>
                <div class="col-span-4 border-r border-gray-300">
                    <div class="text-center font-bold bg-base-200 border-b border-gray-300 py-1">TRANSPORTISTA</div>
                    <div class="p-1 border-b border-gray-300">NOMBRE: {{ custody_chain.driver_name|default:"" }}</div>
                    <div class="p-1 border-b border-gray-300">C.I.: {{ custody_chain.dni_driver|default:"" }}</div>
                    <div class="p-1 border-b border-gray-300">CARGO: {{ custody_chain.driver_position|default:"" }}</div>
                    <div class="p-1 border-b border-gray-300">FECHA: {{ custody_chain.driver_date|date:"d/m/Y"|default:"" }}</div>
                    <div class="p-1">FIRMA:</div>
                </div>
                <div class="col-span-4">
                    <div class="text-center font-bold bg-base-200 border-b border-gray-300 py-1">LUGAR DE DISPOSICIÓN FINAL</div>
                    <div class="p-1 border-b border-gray-300">PEISOL S.A.</div>
                    <div class="p-1 border-b border-gray-300">2191744791001</div>
                    <div class="p-1 border-b border-gray-300 h-8"></div>
                    <div class="p-1 border-b border-gray-300 h-8"></div>
                    <div class="p-1 text-center mt-6">RECIBÍ CONFORME</div>
                </div>
            </div>

            <!-- Observaciones -->
            <div class="text-xs mt-2 border border-gray-300">
                <div class="text-center font-bold bg-base-200 border-b border-gray-300 py-1">OBSERVACIONES</div>
                <div class="p-2 min-h-[80px]">{{ custody_chain.notes|default:"" }}</div>
            </div>
        </div>
    </div>
</div>

<script>
function exportToPDF() {
    alert('Funcionalidad de exportación a PDF en desarrollo');
    // TODO: Implementar exportación a PDF
}
</script>
{% endblock %}
